/*
 * Webim v1.0.0pre
 * http://www.nextim.cn/
 *
 * Copyright (c) 2009 Hidden
 *
 * Date:   Wed Apr 28 19:54:26 2010 +0800
 * Revision: 
 */
(function(H,d,l){function I(){return(new Date).getTime()}function c(P){var Q=location;var R=new RegExp("(^|&|\\?)"+P+"=(\\d*)(&|$)","i");if(R.test(Q)){return RegExp.$1}return""}var x=Object.prototype.toString;function q(P){return x.call(P)==="[object Function]"}function u(P){return x.call(P)==="[object Array]"}function D(P){return P&&x.call(P)==="[object Object]"}function a(P){return(P||"").replace(/^\s+|\s+$/g,"")}function O(P,S){var R=false;if(D(S)){P=P||{};for(var Q in S){var T=S[Q];if(P[Q]!=T){R=R||{};R[Q]=T}}}return R}function p(R){var P=[];if(R!=null){var Q=R.length;if(Q==null||typeof R==="string"||q(R)||R.setInterval){P[0]=R}else{while(Q){P[--Q]=R[Q]}}}return P}function j(){var U=arguments[0]||{},S=1,T=arguments.length,P=false,R;if(typeof U==="boolean"){P=U;U=arguments[1]||{};S=2}if(typeof U!=="object"&&!q(U)){U={}}for(;S<T;S++){if((R=arguments[S])!=null){for(var Q in R){var V=U[Q],W=R[Q];if(U===W){continue}if(P&&W&&typeof W==="object"&&!W.nodeType){U[Q]=j(P,V||(W.length!=null?[]:{}),W)}else{if(W!==l){U[Q]=W}}}}}return U}function J(S,W,R){var Q,T=0,U=S.length,P=U===l||q(S);if(R){if(P){for(Q in S){if(W.apply(S[Q],R)===false){break}}}else{for(;T<U;){if(W.apply(S[T++],R)===false){break}}}}else{if(P){for(Q in S){if(W.call(S[Q],Q,S[Q])===false){break}}}else{for(var V=S[0];T<U&&W.call(V,T,V)!==false;V=S[++T]){}}}return S}function K(R,S){for(var P=0,Q=S.length;P<Q;P++){if(S[P]===R){return P}}return -1}function M(Q,U,P){var R=[];for(var S=0,T=Q.length;S<T;S++){if(!P!==!U(Q[S],S)){R.push(Q[S])}}return R}function v(P,U){var Q=[],T;for(var R=0,S=P.length;R<S;R++){T=U(P[R],R);if(T!=null){Q[Q.length]=T}}return Q.concat.apply([],Q)}var s={option:function(R,S){var Q=R,P=this;P.options=P.options||{};if(typeof R=="string"){if(S===l){return P.options[R]}Q={};Q[R]=S}j(P.options,Q);return P},bind:function(R,Q){var P=this,S=P._events=P._events||{};if(q(Q)){S[R]=S[R]||[];S[R].push(Q)}return this},trigger:function(U,R){var Q=this,V=Q._events=Q._events||{},T=V[U];if(!T){return this}R=u(R)?R:p(R);for(var S=0,P=T.length;S<P;S++){T[S].apply(this,R)}return this},unbind:function(T,S){var Q=this,U=Q._events=Q._events||{};if(!U[T]){return this}if(q(S)){var P=U[T];for(var R=P.length;R--;R){if(P[R]===S||P[R]===S._proxy){P.splice(R,1)}}}else{delete U[T]}return this},one:function(S,R){if(!q(R)){return this}var P=this,Q=R._proxy=fun._proxy||function(){P.unbind(S,Q);return R.apply(this,arguments)};P.bind(S,Q)}};function g(P){var R=[];if(typeof P=="object"){for(var Q in P){R[R.length]=encodeURIComponent(Q)+"="+encodeURIComponent(P[Q])}return R.join("&").replace(N,"+")}return P}var f=I(),G=/\?/,E=/(\?|&)_=.*?(&|$)/,N=/%20/g,i={url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return H.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest()},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},C={},o={};function L(Q,S,P,R){if(Q.error){Q.error.call(Q.context||H,S,P,R)}}function r(Q){try{return !Q.status&&location.protocol==="file:"||(Q.status>=200&&Q.status<300)||Q.status===304||Q.status===1223||Q.status===0}catch(P){}return false}function m(S,Q){var R=S.getResponseHeader("Last-Modified"),P=S.getResponseHeader("Etag");if(R){C[Q]=R}if(P){o[Q]=P}return S.status===304||S.status===0}function t(U,S,R){var Q=U.getResponseHeader("content-type"),P=S==="xml"||!S&&Q&&Q.indexOf("xml")>=0,T=P?U.responseXML:U.responseText;if(P&&T.documentElement.nodeName==="parsererror"){throw"parsererror"}if(R&&R.dataFilter){T=R.dataFilter(T,S)}if(typeof T==="string"){if(S==="json"){if(typeof h==="object"&&h.parse){T=h.parse(T)}else{T=(new Function("return "+T))()}}}return T}function F(P){j(i,P)}function z(ac){ac=j(true,ac,j(true,{},i,ac));var S,T,R=ac.context||H,X=ac.type.toUpperCase();if(ac.data&&ac.processData&&typeof ac.data!=="string"){ac.data=g(ac.data)}if(ac.cache===false&&X==="GET"){var W=I();var V=ac.url.replace(E,"$1_="+W+"$2");ac.url=V+((V===ac.url)?(G.test(ac.url)?"&":"?")+"_="+W:"")}if(ac.data&&X==="GET"){ac.url+=(G.test(ac.url)?"&":"?")+ac.data}var Q=false;var ab=ac.xhr();if(ac.username){ab.open(X,ac.url,ac.async,ac.username,ac.password)}else{ab.open(X,ac.url,ac.async)}try{if(ac.data){ab.setRequestHeader("Content-Type",ac.contentType)}if(ac.ifModified){if(C[ac.url]){ab.setRequestHeader("If-Modified-Since",C[ac.url])}if(o[ac.url]){ab.setRequestHeader("If-None-Match",o[ac.url])}}ab.setRequestHeader("X-Requested-With","XMLHttpRequest");ab.setRequestHeader("Accept",ac.dataType&&ac.accepts[ac.dataType]?ac.accepts[ac.dataType]+", */*":ac.accepts._default)}catch(U){}if(ac.beforeSend&&ac.beforeSend.call(R,ab,ac)===false){ab.abort();return false}var Z=function(ad){if(!ab||ab.readyState===0){if(Y){clearInterval(Y);Y=null}}else{if(!Q&&ab&&(ab.readyState===4||ad==="timeout")){Q=true;if(Y){clearInterval(Y);Y=null}S=ad==="timeout"?"timeout":!r(ab)?"error":ac.ifModified&&m(ab,ac.url)?"notmodified":"success";if(S==="success"){try{T=t(ab,ac.dataType,ac)}catch(ae){S="parsererror"}}if(S==="success"||S==="notmodified"){aa()}else{L(ac,ab,S)}P();if(ad){ab.abort()}if(ac.async){ab=null}}}};if(ac.async){var Y=setInterval(Z,13);if(ac.timeout>0){setTimeout(function(){if(ab&&!Q){Z("timeout")}},ac.timeout)}}try{ab.send(X==="POST"||X==="PUT"?ac.data:null)}catch(U){L(ac,ab,null,U)}if(!ac.async){Z()}function aa(){if(ac.success){ac.success.call(R,T,S)}}function P(){if(ac.complete){ac.complete.call(R,ab,S)}}return ab}function y(){}function k(X){X=j({},X);var R=""+g(X.data),P=X.context||H,V="jsonp"+f++,T=d.getElementsByTagName("head")[0]||d.documentElement,U=d.createElement("script");R=(R?(R+"&"):"")+(X.jsonp||"callback")+"="+V;X.url+=(G.test(X.url)?"&":"?")+R;U.src=X.url;if(X.scriptCharset){U.charset=X.scriptCharset}var Q=false;H[V]=function(Y){X.success&&X.success.call(P,Y,"success");W()};U.onload=U.onreadystatechange=function(){if(!Q&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){S("error");W()}};if(X.timeout>0){setTimeout(function(){if(!Q){S("timeout");W();H[V]=y}},X.timeout)}T.insertBefore(U,T.firstChild);return l;function W(){Q=true;H[V]=l;try{delete H[V]}catch(Y){}U.onload=U.onreadystatechange=null;if(T&&U.parentNode){T.removeChild(U)}}function S(Y){X.error&&X.error.call(P,Y)}}var h=(function(){var Q={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function R(S){return Q[S]||"\\u00"+Math.floor(S.charCodeAt()/16).toString(16)+(S.charCodeAt()%16).toString(16)}function P(X){switch(Object.prototype.toString.call(X)){case"[object String]":return'"'+X.replace(/[\x00-\x1f\\"]/g,R)+'"';case"[object Array]":var T=[],S=X.length;for(var W=0;W<S;W++){T.push(P(X[W]))}return"["+T.join(",")+"]";case"[object Object]":var T=[];for(var V in X){var U=P(X[V]);if(U){T.push(P(V)+":"+U)}}return"{"+T+"}";case"[object Number]":case"[object Boolean]":return String(X);case false:return"null"}return null}return{encode:P,decode:function(S){if(!S||!S.length){return null}return(new Function("return "+S))()}}})();function A(R,Q){var P=this;P._setting();P.options={jsonp:false,host:null,port:null,server:null,ticket:null,domain:null,url:{send:null}};j(P.options,Q)}j(A.prototype,s,{_setting:function(){var P=this;P.connected=false;P._connecting=false;P._onPolling=false;P._pollTimer=null;P._pollingTimes=0;P._failTimes=0},connect:function(R){var P=this;j(P.options,R);if(P._connecting){return P}P._connecting=true;var R=P.options,Q=false,S=[];J(["server","ticket","domain"],function(U,T){if(!R[T]){S.push(T);S.push(" required.");Q=true}});if(Q){P._onError("error",S.join(" "));return P}if(!P._onPolling){H.setTimeout(function(){P._startPolling()},300)}return P},close:function(){var P=this;if(P._pollTimer){clearTimeout(P._pollTimer)}P._setting();return P},_onConnect:function(){var P=this;P.connected=true;P.trigger("connect","success")},_onClose:function(P){var Q=this;Q._setting();Q.trigger("close",[P])},_onData:function(Q){var P=this;P.trigger("data",Q)},_onError:function(Q){var P=this;P._setting();P.trigger("error",Q)},_startPolling:function(){var P=this,R=P.options;P._onPolling=true;P._pollingTimes++;var Q=R.server+"/packets";var S={domain:R.domain,ticket:R.ticket};var T={url:Q,data:S,timeout:40000,cache:false,context:P,success:P._onPollSuccess,error:P._onPollError};if(R.jsonp){j(T,{timeout:40000,dataType:"jsonp",jsonp:"callback"});k(T)}else{z(T)}},_onPollSuccess:function(Q){var P=this;P._onPolling=false;if(!P._connecting){return}if(P._pollingTimes==1){P._onConnect()}P._onData(Q);P._failTimes=0;P._pollTimer=H.setTimeout(function(){P._startPolling()},200)},_onPollError:function(P){var Q=this;Q._onPolling=false;if(!Q._connecting){return}Q._failTimes++;if(Q._pollingTimes==1){Q._onError("can not connect.")}else{if(Q._failTimes>1){Q._onClose(P)}else{Q._pollTimer=H.setTimeout(function(){Q._startPolling()},200)}}}});function w(Q,X,aa){if(typeof X!="undefined"){aa=aa||{};if(X===null){X="";aa=j({},aa);aa.expires=-1}var T="";if(aa.expires&&(typeof aa.expires=="number"||aa.expires.toUTCString)){var U;if(typeof aa.expires=="number"){U=new Date();U.setTime(U.getTime()+(aa.expires*24*60*60*1000))}else{U=aa.expires}T="; expires="+U.toUTCString()}var Z=aa.path?"; path="+(aa.path):"";var V=aa.domain?"; domain="+(aa.domain):"";var P=aa.secure?"; secure":"";d.cookie=[Q,"=",encodeURIComponent(X),T,Z,V,P].join("")}else{var S=null;if(d.cookie&&d.cookie!=""){var Y=d.cookie.split(";");for(var W=0;W<Y.length;W++){var R=a(Y[W]);if(R.substring(0,Q.length+1)==(Q+"=")){S=decodeURIComponent(R.substring(Q.length+1));break}}}return S}}function e(R,Q){var P=this;P.options=j({},e.defaults,Q);this._init(R,Q)}j(e.prototype,s,{_init:function(){var P=this;P.data={user:{}};P.status=new e.status();P.setting=new e.setting();P.buddy=new e.buddy();P.room=new e.room();P.history=new e.history();P.connection=new A(null,{jsonp:true});P._initEvents()},ready:function(){var P=this;P._unloadFun=H.onbeforeunload;H.onbeforeunload=function(){};P.trigger("ready")},go:function(){var Q=this,T=Q.data,V=Q.history,R=Q.buddy,U=Q.room;Q.connection.connect(T.connection);V.option("userInfo",T.user);V.init(T.histories);R.handle(T.buddies);R.online(T.buddy_online_ids,true);var P=Q.setting.get("block_list"),S=T.rooms;u(P)&&S&&J(P,function(Y,X){S[X]&&(S[X].blocked=true)});U.handle(S);U.options.ticket=T.connection.ticket;var W=T.new_messages;if(W&&W.length){Q.trigger("message",[W])}Q.trigger("go",[T])},stop:function(Q){var P=this;H.onbeforeunload=P._unloadFun;P.data.user.presence="offline";P.buddy.clear();P.trigger("stop",Q)},autoOnline:function(){return !this.status.get("o")},_initEvents:function(){var R=this,P=R.status,S=R.setting,T=R.history,Q=R.connection;Q.bind("connect",function(V,U){}).bind("data",function(U){R.handle(U)}).bind("error",function(U){R.stop("connect error")}).bind("close",function(U){R.stop("disconnect")})},handle:function(Q){var P=this;Q.messages&&Q.messages.length&&P.trigger("message",[Q.messages]);Q.presences&&Q.presences.length&&P.trigger("presence",[Q.presences]);Q.statuses&&Q.statuses.length&&P.trigger("status",[Q.statuses])},sendMsg:function(Q){var P=this;Q.ticket=P.data.connection.ticket;z({type:"post",url:P.options.urls.message,type:"post",cache:false,data:Q})},sendStatus:function(Q){var P=this;Q.ticket=P.data.connection.ticket;z({type:"post",url:P.options.urls.status,type:"post",cache:false,data:Q})},setStranger:function(P){this.stranger_ids=B(P)},stranger_ids:[],online:function(){var Q=this,P=Q.status,R=[],S=P.get("tabs"),T=P.get("tabIds");P.set("o",false);Q.ready();T&&T.length&&S&&J(S,function(V,U){U.t=="buddy"&&R.push(V)});z({type:"post",dataType:"json",data:{buddy_ids:R.join(","),stranger_ids:Q.stranger_ids.join(","),room_ids:c(Q.roomIdendify),timestamp:parseInt(new Date().getTime()/1000)},url:Q.options.urls.online,success:function(U){if(!U||!U.user||!U.connection){Q.stop("online error")}else{U.user=j(Q.data.user,U.user);Q.data=U;Q.go()}},error:function(U){Q.stop("online error")}})},offline:function(){var P=this,Q=P.data;P.status.set("o",true);P.connection.close();P.stop("offline");z({type:"post",url:P.options.urls.offline,type:"post",cache:false,data:{status:"offline",ticket:Q.connection.ticket}})},refresh:function(){var P=this,Q=P.data;if(!Q||!Q.connection||!Q.connection.ticket){return}z({type:"post",url:P.options.urls.refresh,type:"post",cache:false,data:{ticket:Q.connection.ticket}})}});function B(P){return P&&P.split?P.split(","):(u(P)?P:(parseInt(P)?[parseInt(P)]:[]))}function b(Q,S,R){function P(V,U){var T=this;T.data=V;T.options=j({},P.defaults,U);q(T._init)&&T._init()}P.defaults=S;j(P.prototype,s,R);e[Q]=P}H.webim=e;j(e,{version:"1.0.0pre",defaults:{},idsArray:B,now:I,isFunction:q,isArray:u,isObject:D,trim:a,makeArray:p,extend:j,each:J,inArray:K,grep:M,map:v,JSON:h,ajax:z,model:b,objectExtend:s});b("setting",{url:"/webim/setting",data:{play_sound:true,buddy_sticky:true,minimize_layout:true,msg_auto_pop:true}},{_init:function(){var P=this;P.data=j({},P.options.data,P.data)},get:function(P){return this.data[P]},set:function(T,V){var R=this,S=T;if(!T){return}if(typeof T=="string"){S={};S[T]=V}var Q=R.data,P=O(Q,S);if(P){J(P,function(W,X){R.trigger("update",[W,X])});var U=j({},Q,S);R.data=U;z({type:"post",url:R.options.url,dataType:"json",cache:false,data:{data:h.encode(U)}})}}});b("status",{key:"_webim"},{_init:function(){var P=this,Q=P.data;if(!Q){var R=w(P.options.key);P.data=R?h.decode(R):{}}else{P._save(Q)}},set:function(S,U){var R=S,Q=this;if(typeof S=="string"){R={};R[S]=U}var P=Q.data;if(O(P,R)){var T=j({},P,R);Q._save(T)}},get:function(P){return this.data[P]},clear:function(){this._save({})},_save:function(P){this.data=P;w(this.options.key,h.encode(P),{path:"/",domain:d.domain})}});b("buddy",{url:"/webim/buddy"},{_init:function(){var P=this;P.data=P.data||[];P.dataHash={};P._cacheData={};P.handle(P.data)},clear:function(){var P=this;P.data=[];P.dataHash={};P._cacheData={}},count:function(U){var T=j({},this.dataHash,this._cacheData),S=0,R;for(var Q in T){if(D(U)){R=true;for(var P in U){if(U[P]!=T[Q][P]){R=false}}if(R){S++}}else{S++}}return S},get:function(P){return this.dataHash[P]},online:function(Q,P){this.changeStatus(Q,"online",true,P)},offline:function(P){this.changeStatus(P,"offline",false)},loadDelay:function(){var Q=this,P=Q._cacheData,R=[];for(var S in P){R.push(S)}Q.load(R)},update:function(P){this.load(P)},changeStatus:function(P,Y,W,S){P=B(P);var T=P.length;if(T){var ab=this,Q=ab._cacheData,V=ab.dataHash,Z=[],R,X=[],aa;for(var U=0;U<T;U++){R=P[U];if(V[R]){Z.push({id:R,presence:Y})}else{aa={id:R,presence:Y};if(!Q[R]||Q[R].presence!=Y){X.push(aa)}if(W){Q[R]=aa}else{if(Q[R]){delete Q[R]}}}}ab.handle(Z);if(W&&!S){ab.loadDelay()}else{if(X.length){if(W){ab.trigger(Y+"Delay",[X])}else{ab.trigger(Y,[X])}}}}},_loadSuccess:function(U){var R=this.self||this,Q=R._cacheData,P=U.length,T,V;for(var S in U){T=U[S];V=T.id;if(Q[V]){j(T,Q[V]);delete Q[V]}}R.handle(U)},load:function(R){R=B(R);if(R.length){var P=this,Q=P.options;z({url:Q.url,cache:false,dataType:"json",data:{ids:R.join(",")},context:P,success:P._loadSuccess})}},handle:function(Q){var Z=this,T=Z.data,U=Z.dataHash,R={};Q=Q||[];var P=Q.length,X,V,Y;for(var S in Q){X=Q[S],id=X.id;if(id){if(!U[id]){U[id]={};T.push(U[id])}Y=O(U[id],X);if(Y){V=Y.presence||"update";R[V]=R[V]||[];j(U[id],Y);R[V].push(U[id])}}}for(var W in R){Z.trigger(W,[R[W]])}}});(function(){b("room",{urls:{join:"/webim/join.php",leave:"/webim/leave.php",member:"/webim/members.php"}},{_init:function(){var P=this;P.data=P.data||[];P.dataHash={}},get:function(P){return this.dataHash[P]},block:function(S){var P=this,R=P.dataHash[S];if(R&&!R.blocked){R.blocked=true;var Q=[];J(P.dataHash,function(U,T){if(T.blocked){Q.push(T.id)}});P.trigger("block",[S,Q])}},unblock:function(S){var P=this,R=P.dataHash[S];if(R&&R.blocked){R.blocked=false;var Q=[];J(P.dataHash,function(U,T){if(T.blocked){Q.push(T.id)}});P.trigger("unblock",[S,Q])}},handle:function(T){var Q=this,S=Q.data,R=Q.dataHash,P={};J(T,function(V,U){var W=U.id;if(W){U.members=U.members||[];U.count=U.count||0;U.all_count=U.all_count||0;if(!R[W]){R[W]=U;S.push(U)}else{j(R[W],U)}Q.trigger("join",[R[W]])}})},addMember:function(S,U){var Q=this;if(u(U)){J(U,function(X,W){Q.addMember(S,W)});return}var T=Q.dataHash[S];if(T){var P=T.members,V;for(var R=P.length;R--;R){if(P[R].id==U.id){V=P[R]}}if(!V){U.name=U.nick||U.name;P.push(U);T.members.length;Q.trigger("addMember",[S,U])}}},removeMember:function(S,R){var T=this.dataHash[S];if(T){var P=T.members,U;for(var Q=P.length;Q--;Q){if(P[Q].id==R){U=P[Q];P.splice(Q,1);T.count--}}U&&self.trigger("removeMember",[S,U])}},initMember:function(Q){var P=this.dataHash[Q];if(P&&!P.initMember){P.initMember=true;this.loadMember(Q)}},loadMember:function(R){var P=this,Q=P.options;z({cache:false,url:Q.urls.member,dataType:"json",data:{ticket:Q.ticket,id:R},success:function(S){J(S,function(U,T){P.addMember(U,T)})}})},join:function(S,Q){var P=this,R=P.options;z({cache:false,url:R.urls.join,dataType:"json",data:{ticket:R.ticket,id:S,nick:Q.name},success:function(T){P.initMember(S);P.handle([T])}})},leave:function(T,Q){var P=this,R=P.options,S=P.dataHash[T];if(S){S.initMember=false;z({cache:false,url:R.urls.leave,data:{ticket:R.ticket,id:T,nick:Q.name}});P.trigger("leave",[S])}},clear:function(){}})})();b("history",{urls:{load:"",clear:""}},{_init:function(){this.data=this.data||{}},get:function(P){return this.data[P]},handle:function(T){var Z=this,V=Z.data,Q={};T=p(T);var S=T.length,Y,R,W=Z.options.userInfo.id;if(!S){return}for(var U=0;U<S;U++){Y=T[U];R=Y.to==W?Y.from:Y.to;if(R!=l){Q[R]=Q[R]||[];Q[R].push(Y)}}var P=[];for(var X in Q){var Y=Q[X];if(V[X]){V[X]=V[X].concat(Y);Z._triggerMsg(X,Y)}else{P.push(X)}}Z.load(P)},_triggerMsg:function(Q,P){this.trigger("data",[Q,P])},clear:function(T){T=B(T);var Q=this,P=T.length,R=Q.options,U;if(P){for(var S=0;S<P;S++){U=T[S];Q.data[U]=[];Q.trigger("clear",[U])}z({url:R.urls.clear,cache:false,dataType:"json",data:{ids:T.join(",")}})}},init:function(S){var Q=this.self||this,P;for(var R in S){P=S[R];Q.data[R]=P;Q._triggerMsg(R,P)}},load:function(S){S=B(S);if(S.length){var P=this,Q=P.options;for(var R=0;R<S.length;R++){P.data[S[R]]=[]}z({url:Q.urls.load,cache:false,dataType:"json",data:{ids:S.join(",")},context:P,success:P.init})}}})})(window,document);
/*
 * Webim UI v2.1.0pre
 * http://www.nextim.cn/
 *
 * Copyright (c) 2009 Hidden
 *
 * Date:   Wed Apr 28 19:54:26 2010 +0800
 * Revision: 
 */
(function(U,j,q){var Q=webim.idsArray,X=webim.now,u=webim.isFunction,A=webim.isArray,S=webim.isObject,d=webim.trim,s=webim.makeArray,p=webim.extend,aa=webim.each,ag=webim.inArray,ak=webim.grep,x=webim.objectExtend,D=webim.map;function al(){return false}function w(ao){var an="";if(ao.length==0){return""}an=ao.replace(/&/g,"&gt;");an=an.replace(/</g,"&lt;");an=an.replace(/>/g,"&gt;");an=an.replace(/    /g,"&nbsp;");an=an.replace(/\'/g,"&#39;");an=an.replace(/\"/g,"&quot;");an=an.replace(/\n/g,"<br />");return an}function r(an){return/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"])*$/.test(an)}function T(an,av,at){if(!an){return an}var ap=0,ao=[],au=an.split(""),ar=au.length;for(var aq=0;aq<ar;aq++){if(ap>=at||ap<av){break}else{if(au[aq].charCodeAt(0)>255){ap+=2}else{ap++}ao.push(au[aq])}}return ao.join("")}function K(an){return an?(an.nodeType?an:j.getElementById(an)):null}function ab(ap,ao){var an=[];for(;ap;ap=ap.nextSibling){if(ap.nodeType==1&&ap!=ao){an.push(ap)}}return an}function v(an){return ab(an.firstChild)}function V(ao,an){return ao&&(new RegExp("(^|\\s+)"+an+"(\\s+|$)").test(ao.className))}function z(ao,an){if(!ao){return}if(!V(ao,an)){ao.className+=" "+an}}function t(ao,an){ao&&(ao.className=ao.className.replace(new RegExp("(^|\\s+)("+an.split(/\s+/).join("|")+")(\\s+|$)","g")," "))}function Z(ap,an,ao){ap&&(ap.className=ap.className.replace(new RegExp("(^|\\s+)("+an.split(/\s+/).join("|")+")(\\s+|$)","g")," ")+" "+ao)}function o(ap,ao,an){l(ap,"mouseover",function(){z(this,ao);an&&(t(this,an))});l(ap,"mouseout",function(){t(this,ao);an&&(z(this,an))})}function h(ap,an,ao){if(typeof ao==="boolean"){ao?z(ap,an):t(ap,an)}else{V(ap,an)?t(ap,an):z(ap,an)}}function O(an){an&&an.style&&(an.style.display="block")}function ac(an){an&&an.style&&(an.style.display="none")}function C(an){an&&an.parentNode&&(an.parentNode.removeChild(an))}function l(ap,ao,an){if(ap.addEventListener){ap.addEventListener(ao,an,false)}else{ap["e"+ao+an]=an;ap[ao+an]=function(){return ap["e"+ao+an](U.event)};ap.attachEvent("on"+ao,ap[ao+an])}}function f(ap,ao,an){if(ap.addEventListener){ap.removeEventListener(ao,an,false)}else{ap.detachEvent("on"+ao,ap[ao+an]);ap[ao+an]=null}}function P(an){if(!an){return}an.stopPropagation&&an.stopPropagation();an.cancelBubble=true}function M(an){if(!an){return}an.preventDefault&&an.preventDefault();an.returnValue=false}function c(an){if(!an.target){an.target=an.srcElement||j}if(an.target.nodeType===3){an.target=an.target.parentNode}return an.target}function I(an){an.setAttribute("unselectable","off");an.style.MozUserSelect="";f(an,"selectstart",al)}function W(an){an.setAttribute("unselectable","on");an.style.MozUserSelect="none";l(an,"selectstart",al)}function k(an){R();if(y){an()}else{B.push(an)}}var y=false,B=[];function b(){if(!y){y=true;if(B){var ao,an=0;while((ao=B[an++])){ao()}B=null}}}var a=false;function R(){if(a){return}a=true;if(j.readyState==="complete"){return b()}if(j.addEventListener){j.addEventListener("DOMContentLoaded",function(){j.removeEventListener("DOMContentLoaded",arguments.callee,false);b()},false)}else{if(j.attachEvent){j.attachEvent("onreadystatechange",function(){if(j.readyState==="complete"){j.detachEvent("onreadystatechange",arguments.callee);b()}});if(j.documentElement.doScroll&&U==U.top){(function(){if(y){return}try{j.documentElement.doScroll("left")}catch(an){setTimeout(arguments.callee,0);return}b()})()}}}l(U,"load",b)}function af(an){var ao=(new Date());ao.setTime(an?(parseFloat(an)+af.timeSkew):(new Date()).getTime());this.date=ao}af.timeSkew=0;af.init=function(an){af.timeSkew=(new Date()).getTime()-parseFloat(an)};p(af.prototype,{getTime:function(){var ap=this.date;var an=ap.getHours();var ao="";var aq=ap.getMinutes();if(aq<10){aq="0"+aq}var ar=an+":"+aq+ao;return ar},getDay:function(ao){var aq=this.date;if(ao){var an=new Date();an.setHours(0);an.setMinutes(0);an.setSeconds(0);an.setMilliseconds(0);var ap=24*60*60*1000;var ar=an.getTime()-aq.getTime();if(ar<=0){return am("dt:today")}else{if(ar<ap){return am("dt:yesterday")}}}return am("dt:monthdate",{month:am(["dt:january","dt:february","dt:march","dt:april","dt:may","dt:june","dt:july","dt:august","dt:september","dt:october","dt:november","dt:december"][aq.getMonth()]),date:aq.getDate()})}});var H=(function(){var ap=true;var ao=function(aq){try{j.getElementById("webim-flashlib").playSound(aq?aq:"/sound/sound.mp3")}catch(ar){}};var an={lib:"sound.swf",msg:"sound/msg.mp3"};return{enable:function(){ap=true},disable:function(){ap=false},init:function(au){p(an,au);var aq=an.lib+"?_"+new Date().getTime();if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){var ar='<embed type="application/x-shockwave-flash" width="10" height="10" id="webim-flashlib" allowscriptaccess="always" src="'+aq+'" />'}else{var ar='<object width="10" height="10" id="webim-flashlib" type="application/x-shockwave-flash" data="'+aq+'">				<param name="allowScriptAccess" value="always" />				<param name="movie" value="'+aq+'" />				<param name="scale" value="noscale" />				</object>'}try{j.getElementById("webim-flashlib-c").innerHTML=ar}catch(at){}},play:function(ar){var aq=r(ar)?ar:an[ar];ap&&ao(aq)}}})();var G=(function(){var ap=false;l(U,"focus",function(){ap=false});l(U,"blur",function(){ap=true});var aq=j.title,an=0,ao=false,ar=null;return function(au,at){if(!ap){return}if(av){clearInterval(av);an=0;ao=false}var av=setInterval(function(){an++;ao=!ao;if(an==at||!ap){clearInterval(av);an=0;ao=false}if(ao){j.title="["+au+"]"+aq}else{j.title=aq}},1500)}})();var Y={};var m=function(ao,an){return Y[an]||""};function am(ap,ao,an){an=p({locale:am.locale},an);var at=am.dictionary[an.locale];if(!S(at)){at={}}var ar=at[ap]===q?ap:at[ap];if(ao){Y=ao;for(var aq in ao){ar=ar.replace(/\{\{(.*?)\}\}/g,m)}}return ar}am.locale="zh-CN";am.dictionary={};am.store=function(an,ao){var ap=am.dictionary;if(!S(ap[an])){ap[an]={}}p(ap[an],ao)};function E(ap,ao){var an=this;an.element=ap;an.options=p({},E.defaults,ao);an._init()}p(E.prototype,x,{_init:function(){var ao=this,an=ao.im=new webim(),ar=ao.layout=new E.layout(null,{chatAutoPop:an.setting.get("msg_auto_pop")}),ap=ao.options;var at=an.setting.data;ao.setting=new E.setting(null,{data:{buddy_sticky:at.buddy_sticky,play_sound:at.play_sound,msg_auto_pop:at.msg_auto_pop,minimize_layout:at.minimize_layout}});ao.buddy=new E.buddy(null,{});var aq=ao.options.menu;ao.menu=new E.menu(null,{data:aq});ar.addApp(ao.menu,{title:am("menu"),icon:"home",sticky:false,onlyIcon:false,isMinimize:true},null,"shortcut");ar.addShortcut(aq);ar.addApp(ao.buddy,{title:am("chat"),icon:"buddy",sticky:an.setting.get("buddy_sticky"),className:"webim-buddy-window",isMinimize:!an.status.get("b"),titleVisibleLength:19});ar.addApp(ao.setting,{title:am("setting"),icon:"setting",sticky:false,onlyIcon:true,isMinimize:true});an.setting.get("play_sound")?H.enable():H.disable();an.setting.get("minimize_layout")?ar.collapse():ar.expand();ao.buddy.offline();ao._initEvents()},addApp:function(ao){var ap=E.apps[ao];if(!ap){return}var an=this;u(ap.init)&&ap.init.apply(an,[]);an.im.bind("ready",function(){u(ap.ready)&&ap.ready.apply(an,[])}).bind("go",function(){u(ap.go)&&ap.go.apply(an,[])}).bind("stop",function(){u(ap.stop)&&ap.stop.apply(an,[])})},initSound:function(an){H.init(an||this.options.soundUrls)},_initEvents:function(){var aA=this,au=aA.im,at=au.buddy,ar=au.history,ap=au.status,aB=au.setting,az=aA.buddy,aC=au.chatlink,aq=aA.layout,ay=aA.setting,an=au.room;au.bind("ready",function(){aq.changeState("ready");O(aq.app("room").window.element);az.online();ay.online()}).bind("go",function(aD){aq.changeState("active");aq.option("user",aD.user);af.init(aD.server_time);aA._initStatus();!az.window.isMinimize()&&at.loadDelay();az.notice("count",at.count({presence:"online"}));aB.set(aD.setting)}).bind("stop",function(aD){aq.changeState("stop");ac(aq.app("room").window.element);aD=="offline"&&aq.removeAllChat();aq.updateAllChat();az.offline();aD&&az.notice(aD);ay.offline()});aB.bind("update",function(aD,aE){switch(aD){case"buddy_sticky":az.window.option("sticky",aE);ay.check_tag(aD,aE);break;case"play_sound":(aE?H.enable():H.disable());ay.check_tag(aD,aE);break;case"msg_auto_pop":aq.option("chatAutoPop",aE);ay.check_tag(aD,aE);break;case"minimize_layout":ay.check_tag(aD,aE);(aE?aq.collapse():aq.expand());break}});ay.bind("change",function(aD,aE){aB.set(aD,aE)});ay.bind("offline",function(){au.trigger("stop");au.offline()});ay.bind("online",function(){au.trigger("ready");au.online()});aq.bind("collapse",function(){aB.set("minimize_layout",true)});aq.bind("expand",function(){aB.set("minimize_layout",false)});aq.bind("displayUpdate",function(aD){aA._updateStatus()});az.bind("select",function(aD){aA.addChat(aD.id,{type:"buddy"})}).bind("online",function(){au.online()}).bind("broadcastselect",function(aD){aA.addBroadcast(aD)});az.window.bind("displayStateChange",function(aD){if(aD!="minimize"){at.loadDelay()}});at.bind("online",function(aD){az.add(aD);aq.updateChat(aD);az.notice("count",at.count({presence:"online"}))});at.bind("onlineDelay",function(aD){az.notice("count",at.count({presence:"online"}))});var ax=function(aD){return S(aD)?aD.id:aD};at.bind("offline",function(aD){az.remove(D(aD,ax));aq.updateChat(aD);az.notice("count",at.count({presence:"online"}))});at.bind("update",function(aD){az.update(aD);aq.updateChat(aD)});au.bind("message",function(aH){var aN=false,aP=this.room.dataHash,aF=aH.length,aK,aJ=au.data.user.id,aE,aL,aO=[],aI="+1";for(var aG=0;aG<aF;aG++){aK=aH[aG];aE=aK.to==aJ?aK.from:aK.to;if(!aK["new"]){aO.push(aE)}aL=aq.chat(aE);aL&&u(aL.status)&&aL.status("");if(!aL){var aM="";if(aK.type==="broadcast"){aM="站长广播"}else{aM=(aK.type==="unicast")?aK.nick:aP[aE].name}if(aK.type==="unicast"){if(aK.from==="0"){aA.addBroadcast(aE,"update",null,"NextIM")}else{aA.addChat(aE,null,null,aM)}}else{if(aK.type==="broadcast"){aA.addBroadcast(aE,null,null,aM)}else{aA.addChat(aE,{type:"room"})}}aL=aq.chat(aE)}aL&&aB.get("msg_auto_pop")&&!aq.activeTabId&&aq.focusChat(aE);aL.window.notifyUser("information",aI);var aD=aL.window.pos;(aD==-1)&&aq.setNextMsgNum(aI);(aD==1)&&aq.setPrevMsgNum(aI);if(aK.from!=aJ){aN=true}}if(aN){H.play("msg");G(am("new message"),5)}ar.handle(aH);at.online(aO,1)});function aw(aD){return aD.type=="offline"}function av(aD){return aD.type=="online"}function ao(aD){return aD.from}au.bind("presence",function(aD){offline=ak(aD,aw);online=ak(aD,av);at.online(D(online,ao),az.window.isMinimize());at.offline(D(offline,ao));online.length&&az.notice("buddyOnline",online.pop()["nick"])});au.bind("status",function(aD){aa(aD,function(aJ,aG){var aF=au.data.user.id;var aI=aG.from;if(aF!=aG.to&&aF!=aG.from){aI=aG.to;var aE=aG.nick}else{var aH=aq.chat(aI);aH&&aH.status(aG.show)}})});ar.bind("data",function(aG,aE){var aF=aq.chat(aG),aD="+"+aE.length;if(aF){aF.history.add(aE)}});ar.bind("clear",function(aE){var aD=aq.chat(aE);aD&&aD.history.clear()})},__status:false,_initStatus:function(){var ap=this,ar=ap.layout;if(ap.__status){return ar.updateAllChat()}ap.__status=true;var ao=ap.im.status,aq=ao.get("tabs"),au=ao.get("tabIds"),at=ao.get("p"),an=ao.get("a");au&&au.length&&aq&&aa(aq,function(aw,av){if(aw==0||aw==="0"){}else{ap.addChat(aw,{type:av.t},{isMinimize:true});ar.chat(aw).window.notifyUser("information",av.n)}});at&&(ar.prevCount=at)&&ar._fitUI();an&&ar.focusChat(an)},addBroadcast:function(an,at,au,aw){var az=this,aq=az.layout,av=az.im,ar=az.im.history,ax=av.data.user,aA=az._isAdmin(ax.id);var ay="";if(aq.chat(0)){return}var ap=ar.get(0);if(!ap){ar.load("0")}if(at==="update"){ay={id:0,name:"NextIM",isadmin:false};aq.addBroadcast(ay,p({user:ax,history:null,block:true,emot:false,clearHistory:false,member:false,msgType:"broadcast"},{name:"NextIM"}),null);aq.chat(0)}else{ay={id:0,name:ad("<%=broadcast%>"),isadmin:aA};aq.addBroadcast(ay,p({user:ax,history:ap,block:true,emot:aA,clearHistory:true,member:false,msgType:"broadcast"},{name:ad("<%=broadcast%>")}),null);var ao=aq.chat(0);ao.bind("sendMsg",function(aB){av.sendMsg(aB);ar.handle(aB)})}},_isAdmin:function(ar){var ao=this,an=ao.im,aq=an.admins;for(var ap=0;ap<aq.length;ap++){if(ar==d(aq[ap])){return true}}return false},addChat:function(ap,aB,ar,ao){var az=this,au=az.layout,ax=az.im,av=az.im.history,aw=ax.buddy,an=ax.room;if(au.chat(ap)){return}if(aB&&aB.type=="room"){var at=av.get(ap),aq=an.get(ap),ay=aq||{id:ap,name:ao||ap};ay.presence="online";au.addChat(ay,p({history:at,block:true,emot:true,clearHistory:false,member:true,msgType:"multicast"},aB),ar);if(!at){av.load(ap)}var aA=au.chat(ap);aA.bind("sendMsg",function(aC){ax.sendMsg(aC);av.handle(aC)}).bind("select",function(aC){aw.online(aC.id,1);az.addChat(aC.id,{type:"buddy"},null,aC.name);au.focusChat(aC.id)}).bind("block",function(aC){an.block(aC.id)}).bind("unblock",function(aC){an.unblock(aC.id)}).window.bind("close",function(){aA.options.info.blocked&&an.leave(ap)});setTimeout(function(){if(aA.options.info.blocked){an.join(ap)}else{an.initMember(ap)}},500);A(aq.members)&&aa(aq.members,function(aD,aC){aA.addMember(aC.id,aC.name,aC.id==ax.data.user.id)})}else{var at=av.get(ap),aq=aw.get(ap);var ay=aq||{id:ap,name:ao||ap};au.addChat(ay,p({history:at,block:false,emot:true,clearHistory:true,member:false,msgType:"unicast"},aB),ar);if(!aq){aw.update(ap)}if(!at){av.load(ap)}au.chat(ap).bind("sendMsg",function(aC){ax.sendMsg(aC);av.handle(aC)}).bind("sendStatus",function(aC){ax.sendStatus(aC)}).bind("clearHistory",function(aC){av.clear(aC.id)})}},_updateStatus:function(){var ao=this,aq=ao.layout,an={},ap=aq.panels;aa(aq.tabs,function(au,at){an[au]={n:at._count(),t:ap[au].options.type}});var ar={tabs:an,tabIds:aq.tabIds,p:aq.prevCount,a:aq.activeTabId,b:aq.app("buddy").window.isMinimize()?0:1};ao.im.status.set(ar)}});var g=function(an,ao){if(ao===q){return parseInt(an.innerHTML)}else{if(ao){ao=(typeof ao=="number")?ao:(parseInt(an.innerHTML)+parseInt(ao));an.innerHTML=ao.toString();O(an)}else{an.innerHTML="0";ac(an)}}return ao};function i(au){var ar=au.getElementsByTagName("*"),aq,av,ap={},at=":",an=at.length;for(var ao=ar.length-1;ao>-1;ao--){aq=ar[ao];av=aq.id;if(av&&av.indexOf(at)==0){ap[av.substring(an,av.length)]=aq}}return ap}function F(ao){var an=j.createElement("div");an.innerHTML=ao;an=an.firstChild;return an}var ad=(function(){var ap=null,ao=/\<\%\=(.*?)\%\>/ig;function an(ar,aq){return ap&&ap[aq]!=q?ap[aq]:am(aq)}return function(ar,aq){if(!ar){return""}ap=aq;return ar.replace(ao,an)}})();var ai={add:function(ao,ap,ar){var aq=E[ao].prototype;for(var an in ar){aq.plugins[an]=aq.plugins[an]||[];aq.plugins[an].push([ap,ar[an]])}},call:function(an,ap,ao){var ar=an.plugins[ap];if(!ar||!an.element.parentNode){return}for(var aq=0;aq<ar.length;aq++){if(an.options[ar[aq][0]]){ar[aq][1].apply(an.element,ao)}}}};var L=1;function J(ap,aq,ao){function an(au,at){var ar=this;ar.id=L++;ar.name=ap;ar.className="webim-"+ap;ar.options=p({},an.defaults,at);u(ar._preInit)&&ar._preInit();ar.element=au||(ar.template&&F(ar.template()))||(ar.options.template&&F(ad(ar.options.template)));if(ar.element){ar.options.className&&z(ar.element,ar.options.className);ar.$=i(ar.element)}u(ar._init)&&ar._init();u(ar._initEvents)&&ar._initEvents()}an.defaults=aq;p(an.prototype,x,J.prototype,ao);E[ap]=an}p(J.prototype,{_init:function(){}});function e(an,ao){E.apps[an]=ao||{}}p(E,{version:"2.1.0pre",widget:J,app:e,plugin:ai,i18n:am,date:af,ready:k,createElement:F,apps:{}});webim.ui=E;J("window",{isMinimize:false,minimizable:true,maximizable:false,closeable:true,sticky:true,titleVisibleLength:12,count:0,template:'<div id=":webim-window" class="webim-window ui-widget">                                            <div class="webim-window-tab-wrap">                                            <div id=":tab" class="webim-window-tab ui-state-default">                                            <div class="webim-window-tab-inner">                                                    <div id=":tabTip" class="webim-window-tab-tip">                                                            <strong id=":tabTipC"><%=tooltip%></strong>                                                    </div>                                                    <a id=":tabClose" title="<%=close%>" class="webim-window-close" href="#close"><em class="ui-icon ui-icon-close"><%=close%></em></a>                                                    <div id=":tabCount" class="webim-window-tab-count">                                                            0                                                    </div>                                                    <em id=":tabIcon" class="webim-icon webim-icon-chat"></em>                                                    <h4 id=":tabTitle"><%=title%></h4>                                            </div>                                            </div>                                            </div>                                            <div><div id=":window" class="webim-window-window">						<iframe id=":bgiframe" class="webim-bgiframe" frameborder="0" tabindex="-1" src="about:blank;" ></iframe>                                                    <div id=":header" class="webim-window-header ui-widget-header ui-corner-top">                                                            <span id=":actions" class="webim-window-actions">                                                                    <a id=":minimize" title="<%=minimize%>" class="webim-window-minimize" href="#minimize"><em class="ui-icon ui-icon-minus"><%=minimize%></em></a>                                                                    <a id=":maximize" title="<%=maximize%>" class="webim-window-maximize" href="#maximize"><em class="ui-icon ui-icon-plus"><%=maximize%></em></a>                                                                    <a id=":close" title="<%=close%>" class="webim-window-close" href="#close"><em class="ui-icon ui-icon-close"><%=close%></em></a>                                                            </span>                                                            <h4 id=":headerTitle"><%=title%></h4>                                                    </div>                                                    <div id=":content" class="webim-window-content ui-widget-content">                                                    </div>                                            </div>                                            </div>                                            </div>'},{html:function(an){return this.$.content.appendChild(an)},_init:function(ap,ao){var an=this,ao=an.options,aq=an.$;ap=an.element;ap.window=an;ao.tabWidth&&(aq.tab.style.width=ao.tabWidth+"px");an.title(ao.title,ao.icon);!ao.minimizable&&ac(aq.minimize);!ao.maximizable&&ac(aq.maximize);if(!ao.closeable){ac(aq.tabClose);ac(aq.close)}if(ao.isMinimize){an.minimize()}else{an.restore()}if(ao.onlyIcon){ac(aq.tabTitle)}else{C(aq.tabTip)}ao.count&&an.notifyUser("information",ao.count);aj(an)},notifyUser:function(ao,ap){var an=this,aq=an.$;if(ao=="information"){if(an.isMinimize()){if(g(aq.tabCount,ap)){z(aq.tab,"ui-state-highlight");t(aq.tab,"ui-state-default")}}}},_count:function(){return g(this.$.tabCount)},title:function(at,ap){var an=this,aq=an.$,ar=aq.tabIcon;if(ap){if(r(ap)){ar.className="webim-icon";ar.style.backgroundImage="url("+ap+")"}else{ar.className="webim-icon webim-icon-"+ap}}aq.tabTipC.innerHTML=at;var ao=T(at,0,an.options.titleVisibleLength);aq.tabTitle.innerHTML=ao;ao&&at&&ao.length<at.length&&aq.tabTitle.setAttribute("title",at);aq.headerTitle.innerHTML=at},_changeState:function(ap){var ao=this.element,an=ap=="restore"?"normal":ap;Z(ao,"webim-window-normal webim-window-maximize webim-window-minimize","webim-window-"+an);this.trigger("displayStateChange",[ap])},active:function(){return V(this.element,"webim-window-active")},activate:function(){var an=this;if(an.active()){return}z(an.element,"webim-window-active");an.trigger("activate")},deactivate:function(){var an=this;if(!an.active()){return}t(an.element,"webim-window-active");if(!an.options.sticky){an.minimize()}an.trigger("deactivate")},_setVisibile:function(){var an=this,ao=an.$;Z(ao.tab,"ui-state-default ui-state-highlight","ui-state-active");an.activate();g(ao.tabCount,0)},maximize:function(){var an=this;if(an.isMaximize()){return}an._setVisibile();an._changeState("maximize")},restore:function(){var an=this;if(V(an.element,"webim-window-normal")){return}an._setVisibile();an._changeState("restore")},minimize:function(){var an=this;if(an.isMinimize()){return}Z(an.$.tab,"ui-state-active","ui-state-default");an.deactivate();an._changeState("minimize")},tabClose:function(){this.close()},close:function(){var an=this;an.trigger("close");C(an.element)},_initEvents:function(){var an=this,ap=an.element,ar=an.$,aq=ar.tab;var ao=function(au){P(au);M(au)};var at=function(au){an.minimize()};l(ar.header,"click",at);l(aq,"click",function(au){if(an.isMinimize()){an.restore()}else{an.minimize()}ao(au)});l(aq,"mouseover",function(){z(this,"ui-state-hover");t(this,"ui-state-default")});l(aq,"mouseout",function(){t(this,"ui-state-hover");this.className.indexOf("ui-state-")==-1&&z(this,"ui-state-default")});l(aq,"mousedown",ao);W(aq);aa(["minimize","maximize","close","tabClose"],function(av,au){l(ar[au],"click",function(aw){if(!this.disabled){an[au]()}ao(aw)});l(ar[au],"mousedown",ao)})},height:function(){return this.$.content.offsetHeight},_fitUI:function(an){return},isMaximize:function(){return V(this.element,"webim-window-maximize")},isMinimize:function(){return V(this.element,"webim-window-minimize")}});var aj=(function(){var an=false;var ar=function(){an&&an.deactivate();an=false;return true};var ap=function(au){var at=this;at&&at!=an&&ar()&&(an=at)};var aq=function(au){var at=this;at&&an==at&&(an=false)};var ao=function(at){if(at.active()){ar();an=at}at.bind("activate",ap);at.bind("deactivate",aq)};l(j,"mousedown",function(av){av=c(av);var at;while(av){if(av.id==":webim-window"){at=av;break}else{av=av.parentNode}}if(at){var au=at.window;au&&au.activate()}else{ar()}});return function(at){ao(at)}})();J("layout",{template:'<div id="webim" class="webim webim-state-ready">                    <div class="webim-preload ui-helper-hidden-accessible">                    <div id="webim-flashlib-c">                    </div>                    </div><div id=":layout" class="webim-layout webim-layout-minimize"><iframe class="webim-bgiframe" frameborder="0" tabindex="-1" src="about:blank;" ></iframe><div class="webim-layout-bg ui-state-default ui-toolbar"></div><div class="webim-ui ui-helper-clearfix">                            <div id=":shortcut" class="webim-shortcut">                            </div>                            <div class="webim-layout-r">                            <div id=":panels" class="webim-panels">                                <div class="webim-window-tab-wrap ui-widget webim-panels-next-wrap">                                            <div id=":next" class="webim-window-tab webim-panels-next ui-state-default">                                                    <div id=":nextMsgCount" class="webim-window-tab-count">                                                            0                                                    </div>                                                    <em class="ui-icon ui-icon-triangle-1-w"></em>                                                    <span id=":nextCount">0</span>                                            </div>                                </div>                                <div id=":tabsWrap" class="webim-panels-tab-wrap">                                        <div id=":tabs" class="webim-panels-tab">                                        </div>                                </div>                                <div class="webim-window-tab-wrap ui-widget webim-panels-prev-wrap">                                            <div id=":prev" class="webim-window-tab webim-panels-prev ui-state-default">                                                    <div id=":prevMsgCount" class="webim-window-tab-count">                                                            0                                                    </div>                                                    <span id=":prevCount">0</span>                                                    <em class="ui-icon ui-icon-triangle-1-e"></em>                                            </div>                                </div>                                <div class="webim-window-tab-wrap webim-collapse-wrap ui-widget">                                            <div id=":collapse" class="webim-window-tab webim-collapse ui-state-default" title="<%=collapse%>">                                                    <em class="ui-icon ui-icon-circle-arrow-e"></em>                                            </div>                                </div>                                <div class="webim-window-tab-wrap webim-expand-wrap ui-widget">                                            <div id=":expand" class="webim-window-tab webim-expand ui-state-default" title="<%=expand%>">                                                    <em class="ui-icon ui-icon-circle-arrow-w"></em>                                            </div>                                </div>                            </div>                            <div id=":apps" class="webim-apps">                            </div>                            </div>            </div></div>                    </div>',shortcutLength:5,chatAutoPop:true,tpl_shortcut:'<div class="webim-window-tab-wrap ui-widget webim-shortcut-item"><a class="webim-window-tab" href="<%=link%>" target="<%=target%>">                                                    <div class="webim-window-tab-tip">                                                            <strong><%=title%></strong>                                                    </div>                                                    <em class="webim-icon" style="background-image:url(<%=icon%>)"></em>                                            </a>                                            </div>'},{_init:function(ap,ao){var an=this,ao=an.options;p(an,{window:U,apps:{},panels:{},tabWidth:136,maxVisibleTabs:null,animationTime:210,activeTabId:null,tabs:{},tabIds:[],nextCount:0,prevCount:0});ao.isMinimize&&an.collapse()},changeState:function(an){this.element.className="webim webim-state-"+an},_ready:false,buildUI:function(aq){var ao=this,ap=ao.$;var an=(ah()-45)-ap.shortcut.offsetWidth-ap.apps.offsetWidth-70;ao.maxVisibleTabs=parseInt(an/ao.tabWidth);ao._fitUI();ao._ready=true},_updatePrevCount:function(ao){var aw=this,at=aw.tabIds,au=aw.maxVisibleTabs,ar=at.length,an=ao,aq=aw.prevCount;if(ar<=au){return}if(!an){aq=ar-au}else{var av=0;for(var ap=0;ap<ar;ap++){if(at[ap]==an){av=ap;break}}if(av<=aq){aq=av}else{if(av>=aq+au){aq=av-au+1}}}aw.prevCount=aq},_setVisibleTabs:function(ax){var az=this,ay=az.prevCount,ao=ay+az.maxVisibleTabs,aw=az.tabs,av=az.tabIds;var au=av.length,at=0,an=0;for(var ar=0;ar<au;ar++){var aq=aw[av[ar]];if(ar<ay||ar>=ao){if(ax){O(aq.element)}else{if(az.activeTabId==av[ar]){aq.minimize()}var ap=aq._count();if(ar<ay){an+=ap;aq.pos=1}else{at+=ap;aq.pos=-1}ac(aq.element)}}else{aq.pos=0;O(aq.element)}}if(!ax){az.setNextMsgNum(at);az.setPrevMsgNum(an)}},setNextMsgNum:function(an){g(this.$.nextMsgCount,an)},setPrevMsgNum:function(an){g(this.$.prevMsgCount,an)},slideing:false,_slide:function(aw){var ay=this,ax=ay.prevCount,ar=ay.nextCount;if((ar>0&&aw==-1)||(ax>0&&aw==1)){ay.slideing=true;if(ar==1&&aw==-1||ax==1&&aw==1){ay.slideing=false}ay._slideSetup(false);ay._setVisibleTabs(true);if(aw==-1){ay.nextCount--;ay.prevCount++}else{if(aw==1){ay.nextCount++;ay.prevCount--}}var av=ay.$.tabs,au=parseFloat(av.style.left),ap=-1*ay.tabWidth*ay.nextCount,an=parseInt(500/13),at=1,aq=(ap-au)/an;var ao=setInterval(function(){av.style.left=au+aq*at+"px";if(at==an){if(ay.slideing){ay._slide(aw)}else{ay._fitUI();ay._slideReset()}clearInterval(ao);return}at++},13)}},_slideUp:function(){this.slideing=false},_slideSetup:function(aq){var ao=this,ar=ao.$,an=ar.tabsWrap,ap=ar.tabs;if(!ao._tabsWidth){ao._tabsWidth=ap.clientWidth}if(aq){ao._tabsWidth=null}an.style.position=aq?"":"relative";an.style.overflow=aq?"visible":"hidden";an.style.width=aq?"":ao._tabsWidth+"px";ap.style.width=aq?"":ao.tabWidth*ao.tabIds.length+"px";ap.style.position=aq?"":"relative"},_slideReset:function(){this._slideSetup(true)},_updateCount:function(){var ap=this,at=ap.tabIds,ao=ap.maxVisibleTabs,an=at.length,aq=ap.prevCount,ar=ap.nextCount;if(an<=ao){ar=0;aq=0}else{ar=an-ao-aq;ar=ar<0?0:ar;aq=an-ao-ar}ap.prevCount=aq;ap.nextCount=ar},_updateCountUI:function(){var an=this,ap=an.$,ao=an.prevCount,aq=an.nextCount;if(aq<=0){z(ap.next,"ui-state-disabled")}else{t(ap.next,"ui-state-disabled")}if(ao<=0){z(ap.prev,"ui-state-disabled")}else{t(ap.prev,"ui-state-disabled")}if(ao>0||aq>0){ap.next.style.display="block";ap.prev.style.display="block"}else{ac(ap.next);ac(ap.prev)}ap.nextCount.innerHTML=aq.toString();ap.prevCount.innerHTML=ao.toString()},_initEvents:function(){var an=this,ap=an.window,ao=an.$;l(ap,"resize",function(){an.buildUI()});l(ao.next,"mousedown",function(){an._slide(-1)});l(ao.next,"mouseup",function(){an._slideUp()});W(ao.next);l(ao.prev,"mousedown",function(){an._slide(1)});l(ao.prev,"mouseup",function(){an._slideUp()});W(ao.prev);l(ao.expand,"click",function(){an.expand();return false});l(ao.collapse,"click",function(){an.collapse();return false});o(ao.collapse,"ui-state-hover","ui-state-default");o(ao.expand,"ui-state-hover","ui-state-default")},isMinimize:function(){return V(this.$.layout,"webim-layout-minimize")},collapse:function(){var an=this;if(an.isMinimize()){return}z(this.$.layout,"webim-layout-minimize");an.trigger("collapse")},expand:function(){var an=this;if(!an.isMinimize()){return}t(an.$.layout,"webim-layout-minimize");an.trigger("expand")},_displayUpdate:function(an){this._ready&&this.trigger("displayUpdate")},_fitUI:function(){var an=this,ap=an.$,ao=ap.apps;an._updateCount();an.$.tabs.style.left=-1*an.tabWidth*an.nextCount+"px";an._updateCountUI();an._setVisibleTabs();an._displayUpdate()},_stickyWin:null,_appStateChange:function(ap,ao){var an=this;if(ao!="minimize"){aa(an.apps,function(aq,ar){if(ar.window!=ap){ar.window.minimize()}})}an._displayUpdate()},app:function(an){return this.apps[an]},addApp:function(au,ap,ar,an){var ao=this,ap=p(ap,{closeable:false});var at,aq=au.element;at=new E.window(null,ap);at.html(aq);ao.$[an?an:"apps"].insertBefore(at.element,ar&&ao.apps[ar]?ao.apps[ar].window.element:null);au.window=at;at.bind("displayStateChange",function(av){ao._appStateChange(this,av)});ao.apps[au.name]=au},focusChat:function(aq){var ao=this,ap=ao.tabs[aq],an=ao.panels[aq];ap&&ap.isMinimize()&&ap.restore();an&&an.focus()},chat:function(an){return this.panels[an]},updateChat:function(ar){ar=s(ar);var ap=this,at,ao=ar.length,an;for(var aq=0;aq<ao;aq++){at=ar[aq];an=ap.panels[at.id];an&&an.update(at)}},updateAllChat:function(){aa(this.panels,function(ao,an){an.update()})},_onChatClose:function(ao){var an=this;an.tabIds=ak(an.tabIds,function(ap,aq){return ap!=ao});delete an.tabs[ao];delete an.panels[ao];an._changeActive(ao,true);an._fitUI()},_onChatChange:function(ap,ao){var an=this;if(ao=="minimize"){an._changeActive(ap,true);an._displayUpdate()}else{an._changeActive(ap);an._fitUI()}},_changeActive:function(aq,ap){var ao=this,an=ao.activeTabId;if(ap){an==aq&&(ao.activeTabId=null)}else{an&&an!=aq&&ao.tabs[an].minimize();ao.activeTabId=aq;ao._updatePrevCount(aq)}},addBroadcast:function(au,aq,ar){var ao=this,ap=ao.panels,av=au.id,an;if(!ap[av]){var at=ao.tabs[av]=new E.window(null,p({isMinimize:ao.activeTabId||!ao.options.chatAutoPop,tabWidth:ao.tabWidth-2,title:"站长广播"},ar)).bind("close",function(){ao._onChatClose(av)}).bind("displayStateChange",function(aw){ao._onChatChange(av,aw)});ao.tabIds.push(av);ao.$.tabs.insertBefore(at.element,ao.$.tabs.firstChild);an=ap[av]=new E.broadcast(null,p({window:at,info:au},aq));!at.isMinimize()&&ao._changeActive(av);ao._fitUI()}},addChat:function(au,aq,ar){var ao=this,ap=ao.panels,av=au.id,an;if(!ap[av]){var at=ao.tabs[av]=new E.window(null,p({isMinimize:ao.activeTabId||!ao.options.chatAutoPop,tabWidth:ao.tabWidth-2},ar)).bind("close",function(){ao._onChatClose(av)}).bind("displayStateChange",function(aw){ao._onChatChange(av,aw)});ao.tabIds.push(av);ao.$.tabs.insertBefore(at.element,ao.$.tabs.firstChild);an=ap[av]=new E.chat(null,p({window:at,user:ao.options.user,info:au},aq));!at.isMinimize()&&ao._changeActive(av);ao._fitUI()}},removeChat:function(ar){ar=Q(ar);var ao=this,at,an=ar.length,aq;for(var ap=0;ap<an;ap++){aq=ao.tabs[ar[ap]];aq&&aq.close()}},removeAllChat:function(){this.removeChat(this.tabIds)},addShortcut:function(aq){var ao=this;if(A(aq)){aa(aq,function(at,ar){ao.addShortcut(ar)});return}if(!S(aq)){return}var ap=ao.$.shortcut,an=ao.options.tpl_shortcut;if(ap.childNodes.length>ao.options.shortcutLength+1){return}an=F(ad(an,{title:am(aq.title),icon:aq.icon,link:aq.link,target:aq.isExtlink?"_blank":""}));o(an.firstChild,"ui-state-hover");ap.appendChild(an)},addWindow:function(){new E.window(null,{})},online:function(){var an=this,ao=an.$},offline:function(){var an=this,ao=an.$}});function ah(){return j.compatMode==="CSS1Compat"&&j.documentElement.clientWidth||j.body.clientWidth}J("emot",{template:'<div class="webim-emot ui-widget-content"><%=emots%></div>'},{_init:function(ao){var an=this,ap=an.element;aa(ap.firstChild.childNodes,function(ar,aq){l(aq,"click",function(at){t(ap,"webim-emot-show");an.trigger("select",this.firstChild.getAttribute("alt"))})})},template:function(){var ao=this,ap=ao.emots=webim.ui.emot.emots;var an=[];an.push('<ul class="ui-helper-clearfix">');aa(ap,function(au,aq){var at=aq.src,ar=aq.t?aq.t:aq.q[0];an.push('<li><img src="');an.push(at);an.push('" title="');an.push(ar);an.push('" alt="');an.push(aq.q[0]);an.push('" /></li>')});an.push("</ul>");return ad(ao.options.template,{emots:an.join("")})},toggle:function(){h(this.element,"webim-emot-show")}});p(E.emot,{emots:[{t:"smile",src:"smile.png",q:[":)"]},{t:"smile_big",src:"smile-big.png",q:[":d",":-d",":D",":-D"]},{t:"sad",src:"sad.png",q:[":(",":-("]},{t:"wink",src:"wink.png",q:[";)",";-)"]},{t:"tongue",src:"tongue.png",q:[":p",":-p",":P",":-P"]},{t:"shock",src:"shock.png",q:["=-O","=-o"]},{t:"kiss",src:"kiss.png",q:[":-*"]},{t:"glasses_cool",src:"glasses-cool.png",q:["8-)"]},{t:"embarrassed",src:"embarrassed.png",q:[":-["]},{t:"crying",src:"crying.png",q:[":'("]},{t:"thinking",src:"thinking.png",q:[":-/",":-\\"]},{t:"angel",src:"angel.png",q:["O:-)","o:-)"]},{t:"shut_mouth",src:"shut-mouth.png",q:[":-X",":-x"]},{t:"moneymouth",src:"moneymouth.png",q:[":-$"]},{t:"foot_in_mouth",src:"foot-in-mouth.png",q:[":-!"]},{t:"shout",src:"shout.png",q:[">:o",">:O"]}],init:function(ao){var ap=webim.ui.emot,aq=ap._q={};ao=p({dir:"webim/static/emot/default"},ao);if(ao.emots){ap.emots=ao.emots}var an=ao.dir+"/";aa(ap.emots,function(at,ar){if(ar&&ar.src){ar.src=an+ar.src}ar&&ar.q&&aa(ar.q,function(av,au){aq[au]=at})})},parse:function(ap){var ao=webim.ui.emot._q,an=webim.ui.emot.emots;ao&&aa(ao,function(aw,ar){var at=an[ar],av=at.src,au=at.t?at.t:at.q[0],aq=[];aq.push('<img src="');aq.push(av);aq.push('" title="');aq.push(au);aq.push('" alt="');aq.push(at.q[0]);aq.push('" />');aw=w(aw);aw=aw.replace(new RegExp("(\\"+".$^*\\[]()|+?{}:<>".split("").join("|\\")+")","g"),"\\$1");ap=ap.replace(new RegExp(aw,"g"),aq.join(""))});return ap}});e("chatlink",{init:function(){var ap=this,an=ap.im;var ao=ap.chatlink=new webim.ui.chatlink(null).bind("select",function(ar){ap.addChat(ar);ap.layout.focusChat(ar)});an.buddy.bind("online",function(ar){ao.online(aq(ar))}).bind("onlineDelay",function(ar){ao.online(aq(ar))}).bind("offline",function(ar){ao.offline(aq(ar))});an.setStranger(ao.idsArray());function aq(ar){return webim.map(ar,function(at,au){return at.id})}},ready:function(){this.chatlink.enable()},go:function(){this.chatlink.remove(this.im.data.user.id)},stop:function(){this.chatlink.disable();this.chatlink.offline(this.chatlink.idsArray())}});J("chatlink",{filterId:function(ao){if(!ao){return false}var an=/space\.php\?uid=(\d+)$|space\-(\d+)\.html$/i.exec(ao);return an&&(an[1]||an[2])},offline:true},{_init:function(){var aA=this,av=aA.element,an={},aB=aA.options,ar=aB.filterId,aw={},ax=aB.offline;var az=j.getElementsByTagName("a"),ay;az&&aa(az,function(aC,aD){var aF=ar(aD.href),aE=aD.innerHTML;if(aF&&v(aD).length==0&&aE){an[aF]=true;ay=aA._temp({id:aF,title:am("chat with",{name:aE}),title2:""});aD.parentNode.insertBefore(ay,aD.nextSibling);aw[aF]?aw[aF].push(ay):(aw[aF]=[ay])}});var ao=ar(U.location.href);if(ao){an[ao]=true;var ap=aA._temp({id:ao,title:"",title2:"<a href='javascript:void 0'>"+am("chat with me")+"</a>"});t(ap,"webim-chatlink-disable");ay=j.createElement("li");ay.className="webim-chatlink-disable";ay.appendChild(ap);var at=j.getElementsByTagName("*"),aq=at.length;for(var au=0;au<aq;au++){ap=at[au],n=ap.className;if(n.indexOf("spacemenu_list")!=-1||n.indexOf("line_list")!=-1){ap.appendChild(ay);break}}aw[ao]?aw[ao].push(ay):(aw[ao]=[ay])}aA.ids=an;aA.anthors=aw},_temp:function(an){var ao=this;var ap=F(ad('<span id="<%=id%>" title="<%=title%>" class="webim-chatlink-disable webim-chatlink'+(ao.options.offline?"":" webim-chatlink-no-offline")+'"><span class="webim-chatlink-off-i"></span></span>',an));l(ap,"click",function(aq){ao.trigger("select",this.id);P(aq);M(aq)});return ap},idsArray:function(){var an=[];aa(this.ids,function(ap,ao){an.push(ap)});return an},disable:function(){var an=this,ap=an.ids;for(var aq in ap){var ao=an.anthors[aq];ao&&aa(ao,function(at,ar){z(ar,"webim-chatlink-disable")})}},enable:function(){var an=this,ap=an.ids;for(var aq in ap){var ao=an.anthors[aq];ao&&aa(ao,function(at,ar){t(ar,"webim-chatlink-disable")})}},remove:function(ar){ar=Q(ar);var ao=this,an=ar.length,at;for(var aq=0;aq<an;aq++){at=ar[aq];var ap=ao.anthors[at];if(ap){aa(ap,function(av,au){C(au)});delete ao.anthors[at];delete ao.ids[at]}}},online:function(ar){ar=Q(ar);var ao=this,an=ar.length;for(var aq=0;aq<an;aq++){var ap=ao.anthors[ar[aq]];ap&&aa(ap,function(au,at){z(at,"webim-chatlink-on")})}},offline:function(ar){ar=Q(ar);var ao=this,an=ar.length;for(var aq=0;aq<an;aq++){var ap=ao.anthors[ar[aq]];ap&&aa(ap,function(au,at){t(at,"webim-chatlink-off")})}},updateUI:function(ao,an){}});J("setting",{template:'<div id="webim-setting" class="webim-setting">                        <ul id=":ul"><%=tags%></ul>                        <div id=":offline" class="webim-setting-offline"><a href="#offline"><%=offline%></a></div>                        <div id=":online" class="webim-setting-online"><a href="#online"><%=online%></a></div>                  </div>',tpl_check:'<li id=":<%=name%>"><input type="checkbox" <%=checked%> id="webim-setting-<%=name%>" name="<%=name%>"/><label for="webim-setting-<%=name%>"><%=label%></label></li>'},{_init:function(){},template:function(){var ao=this,an=[],ap=ao.options.data;ap&&aa(ap,function(aq,ar){an.push(ao._check_tpl(aq,ar))});return ad(ao.options.template,{tags:an.join("")})},_initEvents:function(){var an=this,ap=an.options.data,ao=an.$;ap&&aa(ap,function(aq,ar){ao[aq]&&an._check_event(ao[aq])});l(ao.offline,"click",function(aq){an.trigger("offline")});l(ao.online,"click",function(aq){an.trigger("online")})},offline:function(){var an=this.$;ac(an.offline);O(an.online)},online:function(){var an=this.$;O(an.offline);ac(an.online)},_check_tpl:function(an,ao){return ad(this.options.tpl_check,{label:am(an),name:an,checked:ao?'checked="checked"':""})},_check_event:function(ao){var an=this;l(ao.firstChild,"click",function(ap){an._change(this.name,this.checked)})},check_tag:function(ap,at){var ao=this;if(S(ap)){aa(ap,function(au,av){ao.check_tag(au,av)});return}var ar=ao.$,an=ar[ap];if(an){an.firstChild.checked=at;return}var aq=ar[ap]=F(ao._check_tpl(ap,at));ao._check_event(aq);ar.ul.appendChild(aq)},_change:function(an,ao){this.trigger("change",[an,ao])},destroy:function(){}});J("buddy",{template:'<div id="webim-buddy" class="webim-buddy">                        <div id=":search" class="webim-buddy-search ui-state-default ui-corner-all"><em class="ui-icon ui-icon-search"></em><input id=":searchInput" type="text" value="" /></div>			<div id=":broadcast" class="webim-broadcast"><a class="ui-helper-clearfix" rel="9" href="#"><img width="25" src="webim/static/images/icons/broadcastx.png"><strong><%=broadcast%></strong><span></span></a></div>                        <div class="webim-buddy-content">                                <div id=":empty" class="webim-buddy-empty"><%=empty buddy%></div>                                <ul id=":ul"></ul>                        </div>                  </div>',tpl_group:'<li><h4 class="ui-state-default"><%=title%>(<%=count%>)</h4><ul></ul></li>',tpl_li:'<li title=""><a href="<%=url%>" rel="<%=id%>" class="ui-helper-clearfix"><img width="25" src="<%=pic_url%>" defaultsrc="<%=default_pic_url%>" onerror="var d=this.getAttribute(\'defaultsrc\');if(d && this.src!=d)this.src=d;" /><strong><%=name%></strong><span><%=status%></span></a></li>'},{_init:function(){var an=this;an.groups={};an.li={};an.li_group={};an._count=0},_initEvents:function(){var ao=this,at=ao.$,aq=at.search,ar=at.broadcast,an=at.searchInput,au=am("search buddy"),ap="ui-state-active";l(aq.firstChild,"click",function(){an.focus()});an.value=au;l(an,"focus",function(){z(aq,ap);if(this.value==au){this.value=""}});l(an,"blur",function(){t(aq,ap);if(this.value==""){this.value=au}});l(an,"keyup",function(){var av=ao.li,aw=this.value;aa(ao.li,function(ay,ax){if(aw&&(ax.text||ax.innerHTML.replace(/<[^>]*>/g,"")).indexOf(aw)==-1){ac(ax)}else{O(ax)}})});l(ar.firstChild,"click",function(av){M(av);ao.trigger("broadcastselect")})},_titleCount:function(){var ao=this,an=ao._count,ar=ao.window,aq=ao.$.empty,ap=ao.element;ar&&ar.title(am("chat")+"("+(an?an:"0")+")");if(!an){O(aq)}else{ac(aq)}if(an>8){ao.scroll(true)}else{ao.scroll(false)}},scroll:function(an){h(this.element,"webim-buddy-scroll",an)},_time:null,_titleBuddyOnline:function(ao){var an=this,ap=an.window;if(!ao){ao=""}if(an._time){clearTimeout(an._time)}an._time=setTimeout(function(){an._titleCount()},5000)},_title:function(an){var ao=this.window;if(ao){ao.title(am("chat")+"["+am(an)+"]")}},notice:function(ap,ao){var an=this;switch(ap){case"buddyOnline":an._titleBuddyOnline(ao);break;case"count":an._count=ao;an._titleCount();break;default:an._title(ap)}},online:function(){var an=this,ao=an.$,ap=an.window;an.notice("connect");O(ao.empty);O(ao.offline);O(ap.element)},offline:function(){var an=this,ao=an.$,ap=an.window;an.notice("offline");ac(ao.offline);ac(ao.empty);an.scroll(false);an.removeAll();ac(ap.element)},_updateInfo:function(an,ao){an=an.firstChild;an.setAttribute("href",ao.url);an=an.firstChild;an.setAttribute("defaultsrc",ao.default_pic_url?ao.default_pic_url:"");an.setAttribute("src",ao.pic_url);an=an.nextSibling;an.innerHTML=ao.name;an=an.nextSibling;an.innerHTML=ao.status;return an},_addOne:function(aq,at){var az=this,ax=az.li,an=aq.id,au=az.$.ul;if(!ax[an]){if(!aq.default_pic_url){aq.default_pic_url=""}var ao=ax[an]=F(ad(az.options.tpl_li,aq));var av=ao.firstChild;l(av,"click",function(aA){M(aA);az.trigger("select",[aq]);this.blur()});var ap=az.groups,ar=am(aq.group||"friend"),aw=ap[ar];if(!aw){var ay=F(ad(az.options.tpl_group));ac(ay);if(ar==am("stranger")){at=true}if(at){au.appendChild(ay)}else{au.insertBefore(ay,au.firstChild)}aw={name:ar,el:ay,count:0,title:ay.firstChild,li:ay.lastChild};az.groups[ar]=aw}if(aw.count==0){O(aw.el)}az.li_group[an]=aw;aw.li.appendChild(ao);aw.count++;aw.title.innerHTML=ar+"("+aw.count+")"}},_updateOne:function(ap){var ao=this,an=ao.li,aq=ap.id;an[aq]&&ao._updateInfo(an[aq],ap)},update:function(ao){ao=s(ao);for(var an=0;an<ao.length;an++){this._updateOne(ao[an])}},add:function(ap,an){ap=s(ap);for(var ao=0;ao<ap.length;ao++){this._addOne(ap[ao],an)}},removeAll:function(){var ap=[],an=this.li;for(var ao in an){ap.push(ao)}this.remove(ap)},remove:function(aq){var au,ap,an=this.li,at,ar=this.li_group;aq=Q(aq);for(var ao=0;ao<aq.length;ao++){au=aq[ao];ap=an[au];if(ap){at=ar[au];if(at){at.count--;if(at.count==0){ac(at.el)}at.title.innerHTML=at.name+"("+at.count+")"}C(ap);delete (an[au])}}},select:function(ap){var an=this,ao=an.li[ap];ao&&ao.firstChild.click();return ao},destroy:function(){}});J("history",{user:{},info:{},template:'<div class="webim-history">                        <div id=":content" class="webim-history-content">                 </div></div>'},{_init:function(){var an=this,ap=an.element,ao=an.options;ai.call(an,"init",[null,an.ui()])},clear:function(){var an=this;an.$.content.innerHTML="";an.trigger("clear")},add:function(ar){ar=s(ar);var ap=this,an=ar.length,ao=[];if(!an){return}for(var aq=0;aq<an;aq++){var at=ar[aq];ao.push(ap._renderMsg(at))}ap.$.content.innerHTML+=ao.join("");ap.trigger("update")},_renderMsg:function(ao){var aC=this;ao=p({},ao);ai.call(aC,"render",[null,aC.ui({msg:ao})]);var aw=ao.from,ax=ao.to,ar=ao.timestamp,aq=ao.body,az=true,ay=aC._lastLogItem,aB=[],ap=aC.options.info,at=aC.options.user;var au=aw==at.id;var av=!au&&at.id!=ax;var an=av?ao.nick:au?at.name:(ap.name?'<a href="'+ap.url+'">'+ap.name+"</a>":ap.id);if(ay&&ay.to==ax&&ay.from==aw&&ar-ay.timestamp<60000){az=false}if(az){aC._lastLogItem=ao;var aA=(new af(ar));aB.push('<h4><span class="webim-gray">');aB.push(aA.getDay(true));aB.push(" ");aB.push(aA.getTime());aB.push("</span>");aB.push(an);aB.push("</h4>")}aB.push("<p>");aB.push(aq);aB.push("</p>");return aB.join("")},_renderDateBreak:function(at){var ap=this,ar=ap._lastLogItem,an=new Date(),aq=new Date(),ao=[];an.setTime(at);ar&&aq.setTime(ar.timestamp);if(!ar||an.getDate()!=aq.getDate()||an.getMonth()!=aq.getMonth()){ao.push("<h5>");ao.push((new af(at)).getDay(true));ao.push("</h5>")}return ao.join("")},ui:function(ao){var an=this;return p({element:an.element,$:an.$},ao)},plugins:{}});var N=(function(){var an;function ao(ar,aq,at){return'<a href="'+(aq=="www."?("http://"+ar):ar)+'"'+an+">"+ar+"</a>"}function ap(aq,ar){an+=" "+aq+'="'+ar+'"'}return function(ar,aq){an="";aq&&S(aq)&&aa(aq,ap);return ar.replace(/(https?:\/\/|www\.)([^\s<]+)/ig,ao)}})();E.history.defaults.parseMsg=true;ai.add("history","parseMsg",{render:function(ao,an){var ap=an.msg.body;ap=w(ap);ap=N(ap,{target:"_blank"});an.msg.body=ap}});E.history.defaults.emot=true;ai.add("history","emot",{render:function(ao,an){an.msg.body=E.emot.parse(an.msg.body)}});J("menu",{template:'<div id="webim-menu" class="webim-menu">                        <ul id=":ul"><%=list%></ul>                        <div id=":empty" class="webim-menu-empty"><%=empty menu%></div>                  </div>',tpl_li:'<li><a href="<%=link%>" target="<%=target%>"><img src="<%=icon%>"/><span><%=title%></span></a></li>'},{_init:function(){var an=this,ap=an.element,ao=an.options;var aq=ao.window;ao.data&&ao.data.length&&ac(an.$.empty)},template:function(){var ao=this,an=[],ap=ao.options.data;ap&&aa(ap,function(aq,ar){an.push(ao._li_tpl(ar))});return ad(ao.options.template,{list:an.join("")})},_li_tpl:function(an){return ad(this.options.tpl_li,{title:am(an.title),icon:an.icon,link:an.link,target:an.isExtlink?"_blank":""})},_fitUI:function(){var an=this.element;if(an.clientHeight>300){an.style.height=300+"px"}},add:function(ap){var an=this;if(A(ap)){aa(ap,function(aq,ar){an.add(ar)});return}var ao=an.$;ac(ao.empty);ao.ul.appendChild(F(an._li_tpl(ap)))},destroy:function(){}});function ae(an){j.selection&&(this.caretPos=j.selection.createRange())}J("chat",{template:'<div class="webim-chat">                                                 <div id=":header" class="webim-chat-header ui-widget-subheader">                                                          <div id=":user" class="webim-user">                                                                 <a id=":userPic" class="webim-user-pic" href="#id"><img width="50" height="50" src="about:blank" defaultsrc="" onerror="var d=this.getAttribute(\'defaultsrc\');if(d && this.src!=d)this.src=d;"></a>                                                                 <span id=":userStatus" title="" class="webim-user-status">Hello</span>                                                         </div>                                                 </div>                                                                                                                                         <div class="webim-chat-notice-wrap"><div id=":notice" class="webim-chat-notice ui-state-highlight"></div></div>                                                 <div id=":content" class="webim-chat-content">                                                                                                                 <div id=":status" class="webim-chat-status webim-gray"></div>                                                 </div>                                                 <div id=":actions" class="webim-chat-actions">                                                         <div id=":toolContent" class="webim-chat-tool-content"></div>                                                        <div id=":tools" class="webim-chat-tools ui-helper-clearfix ui-state-default"></div>                                                        <table class="webim-chat-t" cellSpacing="0">                                                                 <tr>                                                                         <td style="vertical-align:top;">                                                                         <em class="webim-icon webim-icon-chat"></em>                                                                        </td>                                                                         <td style="vertical-align:top;width:100%;">                                                                         <div class="webim-chat-input-wrap">                                                                                <textarea id=":input" class="webim-chat-input webim-gray"><%=input notice%></textarea>                                                                         </div>                                                                         </td>                                                                 </tr>                                                         </table>                                                 </div>                                         </div>'},{_init:function(){var an=this,ap=an.element,ao=an.options,ar=an.window=ao.window;var aq=an.history=new E.history(null,{user:ao.user,info:ao.info});an.$.content.insertBefore(aq.element,an.$.content.firstChild);if(ar){ar.html(ap);an._bindWindow()}an.update(ao.info);aq.add(ao.history);ai.call(an,"init",[null,an.ui()]);an._adjustContent()},update:function(aq){var an=this;if(aq){an.option("info",aq);an.history.option("info",aq);an._updateInfo(aq)}var ap=an.options.user.presence=="online";var ao=an.options.info.presence=="online";if(!ap){an.notice(am("user offline notice"))}else{if(!ao){an.notice(am("buddy offline notice",{name:an.options.info.name}))}else{an.notice("")}}ai.call(an,"update",[null,an.ui()])},focus:function(){var an=this.$.input;U.setTimeout(function(){an.focus()},0)},_noticeTime:null,_noticeTxt:"",notice:function(ar,ao){var an=this,ap=an.$.notice,aq=an._noticeTime;if(aq){clearTimeout(aq)}if(!ar){an._noticeTxt=null;ac(ap);return}if(ao){ap.innerHTML=ar;O(ap);setTimeout(function(){if(an._noticeTxt){ap.innerHTML=an._noticeTxt}else{ac(ap,500)}},ao)}else{an._noticeTxt=ar;ap.innerHTML=ar;O(ap)}},_adjustContent:function(){var an=this.$.content;an.scrollTop=an.scrollHeight},_fitUI:function(aq){var an=this,ap=an.window,ao=an.$;an._adjustContent()},_bindWindow:function(){var an=this,ao=an.window;ao.bind("displayStateChange",function(ap){if(ap!="minimize"){U.setTimeout(function(){an.$.input.focus()},0);an._adjustContent()}})},_inputAutoHeight:function(){var ao=this.$.input,ap=ao[0].scrollTop;if(ap>0){var an=ao.height();if(an>32&&an<100){ao.height(an+ap)}}},_sendMsg:function(ar){var an=this,ao=an.options,ap=ao.info;var aq={type:ao.msgType,to:ap.id,from:ao.user.id,stype:"",offline:ap.presence=="online"?0:1,body:ar,timestamp:(new Date()).getTime()};ai.call(an,"send",[null,an.ui({msg:aq})]);an.trigger("sendMsg",aq)},_inputkeypress:function(aq){var an=this,ap=an.$;if(aq.keyCode==13){if(aq.ctrlKey){an.insert("\n",true);return true}else{var ao=c(aq),ar=ao.value;if(d(ar)){an._sendMsg(ar);ao.value="";M(aq)}}}else{an._typing()}},_onFocusInput:function(ap){var an=this,ao=c(ap);var aq=U.getSelection?U.getSelection().toString():(j.selection?j.selection.createRange().text:"");if(!aq){U.setTimeout(function(){an.$.input.focus()},0)}},_initEvents:function(){var ap=this,aq=ap.options,ar=ap.$,at=am("input notice"),an="webim-gray",ao=ar.input;ap.history.bind("update",function(){ap._adjustContent()}).bind("clear",function(){ap.notice(am("clear history notice"),3000)});l(ao,"keyup",function(){ae.call(this)});l(ao,"click",ae);l(ao,"select",ae);l(ao,"focus",function(){t(this,an);if(this.value==at){this.value=""}});l(ao,"blur",function(){if(this.value==""){z(this,an);this.value=at}});l(ao,"keypress",function(au){ap._inputkeypress(au)});l(ar.content,"click",function(au){ap._onFocusInput(au)})},_updateInfo:function(ap){var an=this,ao=an.$;ao.userPic.setAttribute("href",ap.url);ao.userPic.firstChild.setAttribute("defaultsrc",ap.default_pic_url?ap.default_pic_url:"");ao.userPic.firstChild.setAttribute("src",ap.pic_url);ao.userStatus.innerHTML=ap.status;an.window.title(ap.name)},insert:function(aw,ao){var ay=this,av=ay.$.input;av.focus();if(!ao){av.value=aw;return}if(!aw){aw=""}if(av.setSelectionRange){var ap=av.value,ax=av.selectionStart,an=av.selectionEnd,at=ap.substring(0,ax),ar=ap.substring(an),au=aw.length;av.value=at+aw+ar;av.setSelectionRange(ax+au,ax+au)}else{if(j.selection){var aq=av.caretPos;if(aq){aq.text=aw;aq.collapse();aq.select()}else{av.value+=aw}}else{av.value+=aw}}},_statusText:"",sendStatus:function(an){var ao=this;if(!an||an==ao._statusText){return}ao._statusText=an;ao.trigger("sendStatus",{to:ao.options.info.id,show:an})},_checkST:false,_typing:function(){var an=this;an.sendStatus("typing");if(an._checkST){clearTimeout(an._checkST)}an._checkST=U.setTimeout(function(){an.sendStatus("clear")},6000)},_setST:null,status:function(ar){ar=ar||"clear";var ao=this,aq=ao.$.status,ap=ao.options.info.name,an="";an=ar=="clear"?"":ap+am(ar);aq.innerHTML=an;ao._adjustContent();if(ao._setST){clearTimeout(ao._setST)}if(an!=""){ao._setST=U.setTimeout(function(){aq.innerHTML=""},10000)}},destroy:function(){this.window.close()},ui:function(ao){var an=this;return p({self:an,$:an.$,history:an.history},ao)},plugins:{}});E.chat.defaults.emot=true;ai.add("chat","emot",{init:function(ar,aq){var an=aq.self;var ap=new E.emot();ap.bind("select",function(at){an.focus();an.insert(at,true)});var ao=F(ad('<a href="#chat-emot" title="<%=emot%>"><em class="webim-icon webim-icon-emot"></em></a>'));l(ao,"click",function(at){M(at);ap.toggle()});aq.$.toolContent.appendChild(ap.element);aq.$.tools.appendChild(ao)},send:function(ao,an){}});E.chat.defaults.clearHistory=true;ai.add("chat","clearHistory",{init:function(aq,ap){var an=ap.self;var ao=F(ad('<a href="#chat-clearHistory" title="<%=clear history%>"><em class="webim-icon webim-icon-clear"></em></a>'));l(ao,"click",function(ar){M(ar);an.trigger("clearHistory",[an.options.info])});ap.$.tools.appendChild(ao)}});E.chat.defaults.block=true;ai.add("chat","block",{init:function(at,ar){var ao=ar.self;var aq=ao.options.info.blocked,ap=ao.options.info.name,au=F('<a href="#chat-block" style="display:'+(aq?"none":"")+'" title="'+am("block group",{name:ap})+'"><em class="webim-icon webim-icon-unblock"></em></a>'),an=F('<a href="#chat-block" style="display:'+(aq?"":"none")+'" title="'+am("unblock group",{name:ap})+'"><em class="webim-icon webim-icon-block"></em></a>');l(au,"click",function(av){M(av);ac(au);O(an);ao.trigger("block",[ao.options.info])});l(an,"click",function(av){M(av);ac(an);O(au);ao.trigger("unblock",[ao.options.info])});ar.$.tools.appendChild(au);ar.$.tools.appendChild(an)}});E.chat.defaults.member=true;p(E.chat.prototype,{addMember:function(au,aq,ap){var ao=this,ar=ao.$.member,an=ao.memberLi;if(an[au]){return}var at=F('<li><a class="'+(ap?"ui-state-disabled":"")+'" href="'+au+'">'+aq+"</a></li>");l(at.firstChild,"click",function(av){M(av);ap||ao.trigger("select",[{id:au,name:aq}])});an[au]=at;ao.$.member.appendChild(at)},removeMember:function(ap){var an=this,ao=an.memberLi[ap];if(ao){an.$.member.removeChild(ao);delete an.memberLi[ap]}}});ai.add("chat","member",{init:function(aq,ap){var an=ap.self,ao=ap.$;an.memberLi={};var ar=F('<div class="webim-member ui-widget-content ui-corner-left"><iframe id=":bgiframe" class="webim-bgiframe" frameborder="0" tabindex="-1" src="about:blank;" ></iframe><ul></ul></div>');ao.member=ar.lastChild;ao.content.parentNode.insertBefore(ar,ao.content)}});function ae(an){j.selection&&(this.caretPos=j.selection.createRange())}J("broadcast",{template:'<div class="webim-chat">                       <div id=":header" class="webim-broadcast-header ui-widget-subheader">                              <div id=":user" class="webim-user">                                   <a id=":userPic" class="webim-user-pic" href="space.php?uid=0"><img width="50" height="50" src="webim/static/images/icons/broadcast.png" defaultsrc="" onerror="var d=this.getAttribute(\'defaultsrc\');if(d && this.src!=d)this.src=d;"></a> 				  	<span id=":userStatus" title="" class="webim-user-status"></span>                             </div>                        </div>                        <div id=":content" class="webim-chat-content">                        </div>                        <div id=":actions" class="webim-chat-actions">                            <div id=":toolContent" class="webim-chat-tool-content"></div>			   			%dynContentTools%                                <table class="webim-chat-t" cellSpacing="0">                                    <tr>                                        <td style="vertical-align:top;"> 				       		%dynContentIcon%                                        </td>                                        <td style="vertical-align:top;width:100%;">                                        	   <div id=":broadcastInput" class="webim-chat-input-wrap">					   	%dynContentInput%                                            </div>                                         </td>                                    </tr>                                </table>                            </div>                        </div>'},{_preInit:function(){var an=this,ao=an.options,aq=ao.info,ap=aq.isadmin;if(ap){ao.template=ao.template.replace("%dynContentIcon%",'<em class="webim-icon webim-icon-chat"></em>');ao.template=ao.template.replace("%dynContentTools%",'<div id=":tools" class="webim-chat-tools ui-helper-clearfix ui-state-default"></div>');ao.template=ao.template.replace("%dynContentInput%",'<textarea id=":input" class="webim-chat-input webim-gray"></textarea>')}else{ao.template=ao.template.replace("%dynContentInput%","");ao.template=ao.template.replace("%dynContentIcon%","");ao.template=ao.template.replace("%dynContentTools%","")}},_init:function(){var an=this,ap=an.element,ao=an.options,at=an.window=ao.window,ar=ao.info;var aq=an.history=new E.history(null,{user:0,info:ao.info});an.$.content.insertBefore(aq.element,an.$.content.firstChild);if(at){at.html(ap);an._bindWindow()}an.update(ao.info);aq.add(ao.history);ai.call(an,"init",[null,an.ui()]);an._adjustContent()},_initEvents:function(){var ap=this,aq=ap.options,at=aq.info.isadmin,ar=ap.$,au=am("input notice"),an="webim-gray",ao=ar.input;ap.history.bind("update",function(){ap._adjustContent()}).bind("clear",function(){ap.notice(am("clear history notice"),3000)});if(at){l(ao,"keyup",function(){ae.call(this)});l(ao,"click",ae);l(ao,"select",ae);l(ao,"focus",function(){t(this,an);if(this.value==au){this.value=""}});l(ao,"blur",function(){if(this.value==""){z(this,an);this.value=au}});l(ao,"keypress",function(av){ap._inputkeypress(av)})}},_inputkeypress:function(aq){var an=this,ap=an.$;if(aq.keyCode==13){if(aq.ctrlKey){an.insert("\n",true);return true}else{var ao=c(aq),ar=ao.value;if(d(ar)){an._sendMsg(ar);ao.value="";M(aq)}}}},_sendMsg:function(ar){var an=this,ao=an.options,ap=ao.info;var aq={type:ao.msgType,to:ap.id,from:ao.user.id,offline:0,body:ar,timestamp:(new Date()).getTime()};ai.call(an,"send",[null,an.ui({msg:aq})]);an.trigger("sendMsg",aq)},update:function(ao){var an=this;if(ao){an.option("info",ao);an.history.option("info",ao);an._updateInfo(ao)}ai.call(an,"update",[null,an.ui()])},_updateInfo:function(ap){var an=this,ao=an.$;an.window.title(ap.name)},insert:function(aw,ao){var ay=this,av=ay.$.input;av.focus();if(!ao){av.value=aw;return}if(!aw){aw=""}if(av.setSelectionRange){var ap=av.value,ax=av.selectionStart,an=av.selectionEnd,at=ap.substring(0,ax),ar=ap.substring(an),au=aw.length;av.value=at+aw+ar;av.setSelectionRange(ax+au,ax+au)}else{if(j.selection){var aq=av.caretPos;if(aq){aq.text=aw;aq.collapse();aq.select()}else{av.value+=aw}}else{av.value+=aw}}},focus:function(){var an=this.$.input;an&&u(an.focus)&&U.setTimeout(function(){an.focus()},0)},_adjustContent:function(){var an=this.$.content;an.scrollTop=an.scrollHeight},_fitUI:function(aq){var an=this,ap=an.window,ao=an.$;an._adjustContent()},_bindWindow:function(){var an=this,ao=an.window;ao.bind("displayStateChange",function(ap){if(ap!="minimize"){U.setTimeout(function(){an.$.input.focus()},0);an._adjustContent()}})},_broadcast:function(ar){var an=this,ao=an.options,ap=ao.info;var aq={type:"broadcast",body:ar,from:ao.user.id,timestamp:(new Date()).getTime()};ai.call(an,"send",[null,an.ui({msg:aq})]);an.trigger("broadcast",aq)},destroy:function(){this.window.close()},ui:function(ao){var an=this;return p({self:an,$:an.$,history:an.history},ao)},plugins:{}});E.chat.defaults.emot=true;ai.add("broadcast","emot",{init:function(ar,aq){var an=aq.self;var ap=new E.emot();ap.bind("select",function(at){an.focus();an.insert(at,true)});var ao=F(ad('<a href="#chat-emot" title="<%=emot%>"><em class="webim-icon webim-icon-emot"></em></a>'));l(ao,"click",function(at){M(at);ap.toggle()});aq.$.toolContent.appendChild(ap.element);aq.$.tools.appendChild(ao)}});e("room",{init:function(){var au=this,an=au.im,av=an.room,ar=an.setting,ap=an.data.user,at=au.layout;var ao=au.room=new webim.ui.room(null).bind("select",function(aw){au.addChat(aw.id,{type:"room"});au.layout.focusChat(aw.id)});at.addApp(ao,{title:am("room"),icon:"room",sticky:false,isMinimize:true},"setting");au.window&&au.window.title(am("room"));av.bind("join",function(aw){aq(aw)}).bind("leave",function(aw){}).bind("block",function(ax,aw){ar.set("block_list",aw);aq(av.get(ax));av.leave(ax,ap)}).bind("unblock",function(ax,aw){ar.set("block_list",aw);aq(av.get(ax));av.join(ax,ap)}).bind("addMember",function(aw,ax){var ay=at.chat(aw);ay&&ay.addMember(ax.id,ax.name,ax.id==an.data.user.id);aq(av.get(aw))}).bind("removeMember",function(aw,ax){var ay=at.chat(aw);ay&&ay.removeMember(ax.id,ax.name);aq(av.get(aw))});function aq(ax){var aw=ax.name;ax=p({},ax,{group:"group",name:aw+"("+(parseInt(ax.count)+"/"+parseInt(ax.all_count))+")"});at.updateChat(ax);ax.blocked&&(ax.name=aw+"("+am("blocked")+")");ao.li[ax.id]?ao.update(ax):ao.add(ax)}},ready:function(){},go:function(){},stop:function(){}});J("room",{template:'<div id="webim-room" class="webim-room">                        <div id=":search" class="webim-room-search ui-state-default ui-corner-all"><em class="ui-icon ui-icon-search"></em><input id=":searchInput" type="text" value="" /></div>                        <div class="webim-room-content">                                <div id=":empty" class="webim-room-empty"><%=empty room%></div>                                <ul id=":ul"></ul>                        </div>                  </div>',tpl_li:'<li title=""><a href="<%=url%>" rel="<%=id%>" class="ui-helper-clearfix"><img width="25" src="<%=pic_url%>" defaultsrc="<%=default_pic_url%>" onerror="var d=this.getAttribute(\'defaultsrc\');if(d && this.src!=d)this.src=d;" /><strong><%=name%></strong><span><%=status%></span></a></li>'},{_init:function(){var an=this;an.li={};an._count=0},_initEvents:function(){var ao=this,ar=ao.$,aq=ar.search,an=ar.searchInput,at=am("search room"),ap="ui-state-active";l(aq.firstChild,"click",function(){an.focus()});an.value=at;l(an,"focus",function(){z(aq,ap);if(this.value==at){this.value=""}});l(an,"blur",function(){t(aq,ap);if(this.value==""){this.value=at}});l(an,"keyup",function(){var au=ao.li,av=this.value;aa(ao.li,function(ax,aw){if(av&&(aw.text||aw.innerHTML.replace(/<[^>]*>/g,"")).indexOf(av)==-1){ac(aw)}else{O(aw)}})})},_titleCount:function(){var ao=this,an=ao._count,ar=ao.window,aq=ao.$.empty,ap=ao.element;ar&&ar.title(am("chat")+"("+(an?an:"0")+")");if(!an){O(aq)}else{ac(aq)}if(an>8){ao.scroll(true)}else{ao.scroll(false)}},scroll:function(an){h(this.element,"webim-room-scroll",an)},_updateInfo:function(an,ao){an=an.firstChild;an.setAttribute("href",ao.url);an=an.firstChild;an.setAttribute("defaultsrc",ao.default_pic_url?ao.default_pic_url:"");an.setAttribute("src",ao.pic_url);an=an.nextSibling;an.innerHTML=ao.name;an=an.nextSibling;an.innerHTML=ao.status;return an},_addOne:function(au,ap){var aq=this,an=aq.li,av=au.id,ar=aq.$.ul;if(!an[av]){if(!au.default_pic_url){au.default_pic_url=""}var at=an[av]=F(ad(aq.options.tpl_li,au));var ao=at.firstChild;l(ao,"click",function(aw){M(aw);aq.trigger("select",[au]);this.blur()});ar.appendChild(at)}},_updateOne:function(ap){var ao=this,an=ao.li,aq=ap.id;an[aq]&&ao._updateInfo(an[aq],ap)},update:function(ao){ao=s(ao);for(var an=0;an<ao.length;an++){this._updateOne(ao[an])}},add:function(ao){ao=s(ao);for(var an=0;an<ao.length;an++){this._addOne(ao[an])}},removeAll:function(){var ap=[],an=this.li;for(var ao in an){ap.push(ao)}this.remove(ap)},remove:function(aq){var au,ap,an=this.li,at,ar=this.li_group;aq=Q(aq);for(var ao=0;ao<aq.length;ao++){au=aq[ao];ap=an[au];if(ap){at=ar[au];if(at){at.count--;if(at.count==0){ac(at.el)}at.title.innerHTML=at.name+"("+at.count+")"}C(ap);delete (an[au])}}},select:function(ap){var an=this,ao=an.li[ap];ao&&ao.firstChild.click();return ao},destroy:function(){}})})(window,document);