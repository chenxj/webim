/*
 * Webim v1.0.0pre
 * http://www.nextim.cn/
 *
 * Copyright (c) 2009 Hidden
 *
 * Date: 
 * Revision: 
 */
(function(G,c,l){function H(){return(new Date).getTime()}var w=Object.prototype.toString;function p(P){return w.call(P)==="[object Function]"}function t(P){return w.call(P)==="[object Array]"}function C(P){return P&&w.call(P)==="[object Object]"}function a(P){return(P||"").replace(/^\s+|\s+$/g,"")}function O(P,S){var R=false;if(C(S)){P=P||{};for(var Q in S){var T=S[Q];if(P[Q]!=T){R=R||{};R[Q]=T}}}return R}function o(R){var P=[];if(R!=null){var Q=R.length;if(Q==null||typeof R==="string"||p(R)||R.setInterval){P[0]=R}else{while(Q){P[--Q]=R[Q]}}}return P}function j(){var U=arguments[0]||{},S=1,T=arguments.length,P=false,R;if(typeof U==="boolean"){P=U;U=arguments[1]||{};S=2}if(typeof U!=="object"&&!p(U)){U={}}for(;S<T;S++){if((R=arguments[S])!=null){for(var Q in R){var V=U[Q],W=R[Q];if(U===W){continue}if(P&&W&&typeof W==="object"&&!W.nodeType){U[Q]=j(P,V||(W.length!=null?[]:{}),W)}else{if(W!==l){U[Q]=W}}}}}return U}function I(S,W,R){var Q,T=0,U=S.length,P=U===l||p(S);if(R){if(P){for(Q in S){if(W.apply(S[Q],R)===false){break}}}else{for(;T<U;){if(W.apply(S[T++],R)===false){break}}}}else{if(P){for(Q in S){if(W.call(S[Q],Q,S[Q])===false){break}}}else{for(var V=S[0];T<U&&W.call(V,T,V)!==false;V=S[++T]){}}}return S}function J(R,S){for(var P=0,Q=S.length;P<Q;P++){if(S[P]===R){return P}}return -1}function L(Q,U,P){var R=[];for(var S=0,T=Q.length;S<T;S++){if(!P!==!U(Q[S],S)){R.push(Q[S])}}return R}function u(P,U){var Q=[],T;for(var R=0,S=P.length;R<S;R++){T=U(P[R],R);if(T!=null){Q[Q.length]=T}}return Q.concat.apply([],Q)}var r={option:function(R,S){var Q=R,P=this;P.options=P.options||{};if(typeof R=="string"){if(S===l){return P.options[R]}Q={};Q[R]=S}j(P.options,Q);return P},bind:function(R,Q){var P=this,S=P._events=P._events||{};if(p(Q)){S[R]=S[R]||[];S[R].push(Q)}return this},trigger:function(U,R){var Q=this,V=Q._events=Q._events||{},T=V[U];if(!T){return this}R=t(R)?R:o(R);for(var S=0,P=T.length;S<P;S++){T[S].apply(this,R)}return this},unbind:function(T,S){var Q=this,U=Q._events=Q._events||{};if(!U[T]){return this}if(p(S)){var P=U[T];for(var R=P.length;R--;R){if(P[R]===S||P[R]===S._proxy){P.splice(R,1)}}}else{delete U[T]}return this},one:function(S,R){if(!p(R)){return this}var P=this,Q=R._proxy=fun._proxy||function(){P.unbind(S,Q);return R.apply(this,arguments)};P.bind(S,Q)}};function f(P){var R=[];if(typeof P=="object"){for(var Q in P){R[R.length]=encodeURIComponent(Q)+"="+encodeURIComponent(P[Q])}return R.join("&").replace(N,"+")}return P}var e=H(),F=/\?/,D=/(\?|&)_=.*?(&|$)/,N=/%20/g,i={url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return G.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest()},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},B={},n={};function K(Q,S,P,R){if(Q.error){Q.error.call(Q.context||G,S,P,R)}}function q(Q){try{return !Q.status&&location.protocol==="file:"||(Q.status>=200&&Q.status<300)||Q.status===304||Q.status===1223||Q.status===0}catch(P){}return false}function m(S,Q){var R=S.getResponseHeader("Last-Modified"),P=S.getResponseHeader("Etag");if(R){B[Q]=R}if(P){n[Q]=P}return S.status===304||S.status===0}function s(U,S,R){var Q=U.getResponseHeader("content-type"),P=S==="xml"||!S&&Q&&Q.indexOf("xml")>=0,T=P?U.responseXML:U.responseText;if(P&&T.documentElement.nodeName==="parsererror"){throw"parsererror"}if(R&&R.dataFilter){T=R.dataFilter(T,S)}if(typeof T==="string"){if(S==="json"){if(typeof g==="object"&&g.parse){T=g.parse(T)}else{T=(new Function("return "+T))()}}}return T}function E(P){j(i,P)}function y(ac){ac=j(true,ac,j(true,{},i,ac));var S,T,R=ac.context||G,X=ac.type.toUpperCase();if(ac.data&&ac.processData&&typeof ac.data!=="string"){ac.data=f(ac.data)}if(ac.cache===false&&X==="GET"){var W=H();var V=ac.url.replace(D,"$1_="+W+"$2");ac.url=V+((V===ac.url)?(F.test(ac.url)?"&":"?")+"_="+W:"")}if(ac.data&&X==="GET"){ac.url+=(F.test(ac.url)?"&":"?")+ac.data}var Q=false;var ab=ac.xhr();if(ac.username){ab.open(X,ac.url,ac.async,ac.username,ac.password)}else{ab.open(X,ac.url,ac.async)}try{if(ac.data){ab.setRequestHeader("Content-Type",ac.contentType)}if(ac.ifModified){if(B[ac.url]){ab.setRequestHeader("If-Modified-Since",B[ac.url])}if(n[ac.url]){ab.setRequestHeader("If-None-Match",n[ac.url])}}ab.setRequestHeader("X-Requested-With","XMLHttpRequest");ab.setRequestHeader("Accept",ac.dataType&&ac.accepts[ac.dataType]?ac.accepts[ac.dataType]+", */*":ac.accepts._default)}catch(U){}if(ac.beforeSend&&ac.beforeSend.call(R,ab,ac)===false){ab.abort();return false}var Z=function(ad){if(!ab||ab.readyState===0){if(Y){clearInterval(Y);Y=null}}else{if(!Q&&ab&&(ab.readyState===4||ad==="timeout")){Q=true;if(Y){clearInterval(Y);Y=null}S=ad==="timeout"?"timeout":!q(ab)?"error":ac.ifModified&&m(ab,ac.url)?"notmodified":"success";if(S==="success"){try{T=s(ab,ac.dataType,ac)}catch(ae){S="parsererror"}}if(S==="success"||S==="notmodified"){aa()}else{K(ac,ab,S)}P();if(ad){ab.abort()}if(ac.async){ab=null}}}};if(ac.async){var Y=setInterval(Z,13);if(ac.timeout>0){setTimeout(function(){if(ab&&!Q){Z("timeout")}},ac.timeout)}}try{ab.send(X==="POST"||X==="PUT"?ac.data:null)}catch(U){K(ac,ab,null,U)}if(!ac.async){Z()}function aa(){if(ac.success){ac.success.call(R,T,S)}}function P(){if(ac.complete){ac.complete.call(R,ab,S)}}return ab}function x(){}function k(X){X=j({},X);var R=""+f(X.data),P=X.context||G,V="jsonp"+e++,T=c.getElementsByTagName("head")[0]||c.documentElement,U=c.createElement("script");R=(R?(R+"&"):"")+(X.jsonp||"callback")+"="+V;X.url+=(F.test(X.url)?"&":"?")+R;U.src=X.url;if(X.scriptCharset){U.charset=X.scriptCharset}var Q=false;G[V]=function(Y){X.success&&X.success.call(P,Y,"success");W()};U.onload=U.onreadystatechange=function(){if(!Q&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){S("error");W()}};if(X.timeout>0){setTimeout(function(){if(!Q){S("timeout");W();G[V]=x}},X.timeout)}T.insertBefore(U,T.firstChild);return l;function W(){Q=true;G[V]=l;try{delete G[V]}catch(Y){}U.onload=U.onreadystatechange=null;if(T&&U.parentNode){T.removeChild(U)}}function S(Y){X.error&&X.error.call(P,Y)}}var g=(function(){var Q={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function R(S){return Q[S]||"\\u00"+Math.floor(S.charCodeAt()/16).toString(16)+(S.charCodeAt()%16).toString(16)}function P(X){switch(Object.prototype.toString.call(X)){case"[object String]":return'"'+X.replace(/[\x00-\x1f\\"]/g,R)+'"';case"[object Array]":var T=[],S=X.length;for(var W=0;W<S;W++){T.push(P(X[W]))}return"["+T.join(",")+"]";case"[object Object]":var T=[];for(var V in X){var U=P(X[V]);if(U){T.push(P(V)+":"+U)}}return"{"+T+"}";case"[object Number]":case"[object Boolean]":return String(X);case false:return"null"}return null}return{encode:P,decode:function(S){if(!S||!S.length){return null}return(new Function("return "+S))()}}})();function z(R,Q){var P=this;P._setting();P.options={jsonp:false,host:null,port:null,server:null,ticket:null,domain:null,url:{send:null}};j(P.options,Q)}j(z.prototype,r,{_setting:function(){var P=this;P.connected=false;P._connecting=false;P._onPolling=false;P._pollTimer=null;P._pollingTimes=0;P._failTimes=0},connect:function(R){var P=this;j(P.options,R);if(P._connecting){return P}P._connecting=true;var R=P.options,Q=false,S=[];I(["server","ticket","domain"],function(U,T){if(!R[T]){S.push(T);S.push(" required.");Q=true}});if(Q){P._onError("error",S.join(" "));return P}if(!P._onPolling){G.setTimeout(function(){P._startPolling()},300)}return P},close:function(){var P=this;if(P._pollTimer){clearTimeout(P._pollTimer)}P._setting();return P},_onConnect:function(){var P=this;P.connected=true;P.trigger("connect","success")},_onClose:function(P){var Q=this;Q._setting();Q.trigger("close",[P])},_onData:function(Q){var P=this;P.trigger("data",Q)},_onError:function(Q){var P=this;P._setting();P.trigger("error",Q)},_startPolling:function(){var P=this,R=P.options;P._onPolling=true;P._pollingTimes++;var Q=R.server+"/packets";var S={domain:R.domain,ticket:R.ticket};var T={url:Q,data:S,timeout:40000,cache:false,context:P,success:P._onPollSuccess,error:P._onPollError};if(R.jsonp){j(T,{timeout:40000,dataType:"jsonp",jsonp:"callback"});k(T)}else{y(T)}},_onPollSuccess:function(Q){var P=this;P._onPolling=false;if(!P._connecting){return}if(P._pollingTimes==1){P._onConnect()}P._onData(Q);P._failTimes=0;P._pollTimer=G.setTimeout(function(){P._startPolling()},200)},_onPollError:function(P){var Q=this;Q._onPolling=false;if(!Q._connecting){return}Q._failTimes++;if(Q._pollingTimes==1){Q._onError("can not connect.")}else{if(Q._failTimes>1){Q._onClose(P)}else{Q._pollTimer=G.setTimeout(function(){Q._startPolling()},200)}}}});function v(Q,X,aa){if(typeof X!="undefined"){aa=aa||{};if(X===null){X="";aa=j({},aa);aa.expires=-1}var T="";if(aa.expires&&(typeof aa.expires=="number"||aa.expires.toUTCString)){var U;if(typeof aa.expires=="number"){U=new Date();U.setTime(U.getTime()+(aa.expires*24*60*60*1000))}else{U=aa.expires}T="; expires="+U.toUTCString()}var Z=aa.path?"; path="+(aa.path):"";var V=aa.domain?"; domain="+(aa.domain):"";var P=aa.secure?"; secure":"";c.cookie=[Q,"=",encodeURIComponent(X),T,Z,V,P].join("")}else{var S=null;if(c.cookie&&c.cookie!=""){var Y=c.cookie.split(";");for(var W=0;W<Y.length;W++){var R=a(Y[W]);if(R.substring(0,Q.length+1)==(Q+"=")){S=decodeURIComponent(R.substring(Q.length+1));break}}}return S}}var M=true;function h(U,V){if(!M){return}var T=new Date(),R=["[",T.getHours(),":",T.getMinutes(),":",T.getSeconds(),"-",T.getMilliseconds(),"]"].join(""),S=R+V+g.encode(U);G.console&&G.console.log(R,V,U);var Q=c.getElementById("webim-log")||c.body;G.air&&G.air.trace(S);if(Q){var P=c.createElement("P");P.innerHTML=S;Q.appendChild(P)}}h.enable=function(){M=true};h.disable=function(){M=false};function d(R,Q){var P=this;P.options=j({},d.defaults,Q);this._init(R,Q)}j(d.prototype,r,{_init:function(){var P=this;P.data={user:{}};P.status=new d.status();P.setting=new d.setting();P.buddy=new d.buddy();P.room=new d.room();P.history=new d.history();P.notification=new d.notification();P.connection=new z(null,{jsonp:true});P._initEvents()},ready:function(){var P=this;P._unloadFun=G.onbeforeunload;G.onbeforeunload=function(){P.refresh()};P.trigger("ready")},go:function(){var Q=this,T=Q.data,V=Q.history,R=Q.buddy,U=Q.room;Q.connection.connect(T.connection);V.option("userInfo",T.user);V.init(T.histories);R.handle(T.buddies);R.online(T.buddy_online_ids,true);var P=Q.setting.get("block_list"),S=T.rooms;t(P)&&S&&I(P,function(Y,X){S[X]&&(S[X].blocked=true)});U.handle(S);U.options.ticket=T.connection.ticket;var W=T.new_messages;if(W&&W.length){Q.trigger("message",[W])}Q.trigger("go",[T])},stop:function(Q){var P=this;G.onbeforeunload=P._unloadFun;P.data.user.presence="offline";P.buddy.clear();P.trigger("stop",Q)},autoOnline:function(){return !this.status.get("o")},_initEvents:function(){var R=this,P=R.status,S=R.setting,T=R.history,Q=R.connection;Q.bind("connect",function(V,U){}).bind("data",function(U){R.handle(U)}).bind("error",function(U){R.stop("connect error")}).bind("close",function(U){R.stop("disconnect")})},handle:function(Q){var P=this;Q.messages&&Q.messages.length&&P.trigger("message",[Q.messages]);Q.presences&&Q.presences.length&&P.trigger("presence",[Q.presences]);Q.statuses&&Q.statuses.length&&P.trigger("status",[Q.statuses])},sendMsg:function(Q){var P=this;Q.ticket=P.data.connection.ticket;y({type:"post",url:P.options.urls.message,type:"post",cache:false,data:Q})},sendStatus:function(Q){var P=this;Q.ticket=P.data.connection.ticket;y({type:"post",url:P.options.urls.status,type:"post",cache:false,data:Q})},setStranger:function(P){this.stranger_ids=A(P)},stranger_ids:[],online:function(){var Q=this,P=Q.status,R=[],S=P.get("tabs"),T=P.get("tabIds");P.set("o",false);Q.ready();T&&T.length&&S&&I(S,function(V,U){U.t=="buddy"&&R.push(V)});y({type:"post",dataType:"json",data:{buddy_ids:R.join(","),stranger_ids:Q.stranger_ids.join(",")},url:Q.options.urls.online,success:function(U){if(!U||!U.user||!U.connection){Q.stop("online error")}else{U.user=j(Q.data.user,U.user);Q.data=U;Q.go()}},error:function(U){Q.stop("online error")}})},offline:function(){var P=this,Q=P.data;P.status.set("o",true);P.connection.close();P.stop("offline");y({type:"post",url:P.options.urls.offline,type:"post",cache:false,data:{status:"offline",ticket:Q.connection.ticket}})},refresh:function(){var P=this,Q=P.data;if(!Q||!Q.connection||!Q.connection.ticket){return}y({type:"post",url:P.options.urls.refresh,type:"post",cache:false,data:{ticket:Q.connection.ticket}})}});function A(P){return P&&P.split?P.split(","):(t(P)?P:(parseInt(P)?[parseInt(P)]:[]))}function b(Q,S,R){function P(V,U){var T=this;T.data=V;T.options=j({},P.defaults,U);p(T._init)&&T._init()}P.defaults=S;j(P.prototype,r,R);d[Q]=P}G.webim=d;j(d,{version:"1.0.0pre",defaults:{},log:h,idsArray:A,now:H,isFunction:p,isArray:t,isObject:C,trim:a,makeArray:o,extend:j,each:I,inArray:J,grep:L,map:u,JSON:g,ajax:y,model:b,objectExtend:r});b("setting",{url:"/webim/setting",data:{play_sound:true,buddy_sticky:true,minimize_layout:false,msg_auto_pop:true}},{_init:function(){var P=this;P.data=j({},P.options.data,P.data)},get:function(P){return this.data[P]},set:function(T,V){var R=this,S=T;if(!T){return}if(typeof T=="string"){S={};S[T]=V}var Q=R.data,P=O(Q,S);if(P){I(P,function(W,X){R.trigger("update",[W,X])});var U=j({},Q,S);R.data=U;y({type:"post",url:R.options.url,dataType:"json",cache:false,data:{data:g.encode(U)}})}}});b("status",{key:"_webim"},{_init:function(){var P=this,Q=P.data;if(!Q){var R=v(P.options.key);P.data=R?g.decode(R):{}}else{P._save(Q)}},set:function(S,U){var R=S,Q=this;if(typeof S=="string"){R={};R[S]=U}var P=Q.data;if(O(P,R)){var T=j({},P,R);Q._save(T)}},get:function(P){return this.data[P]},clear:function(){this._save({})},_save:function(P){this.data=P;v(this.options.key,g.encode(P),{path:"/",domain:c.domain})}});b("buddy",{url:"/webim/buddy"},{_init:function(){var P=this;P.data=P.data||[];P.dataHash={};P._cacheData={};P.handle(P.data)},clear:function(){var P=this;P.data=[];P.dataHash={};P._cacheData={}},count:function(U){var T=j({},this.dataHash,this._cacheData),S=0,R;for(var Q in T){if(C(U)){R=true;for(var P in U){if(U[P]!=T[Q][P]){R=false}}if(R){S++}}else{S++}}return S},get:function(P){return this.dataHash[P]},online:function(Q,P){this.changeStatus(Q,"online",true,P)},offline:function(P){this.changeStatus(P,"offline",false)},loadDelay:function(){var Q=this,P=Q._cacheData,R=[];for(var S in P){R.push(S)}Q.load(R)},update:function(P){this.load(P)},changeStatus:function(P,Y,W,S){P=A(P);var T=P.length;if(T){var ab=this,Q=ab._cacheData,V=ab.dataHash,Z=[],R,X=[],aa;for(var U=0;U<T;U++){R=P[U];if(V[R]){Z.push({id:R,presence:Y})}else{aa={id:R,presence:Y};if(!Q[R]||Q[R].presence!=Y){X.push(aa)}if(W){Q[R]=aa}else{if(Q[R]){delete Q[R]}}}}ab.handle(Z);if(W&&!S){ab.loadDelay()}else{if(X.length){if(W){ab.trigger(Y+"Delay",[X])}else{ab.trigger(Y,[X])}}}}},_loadSuccess:function(U){var R=this.self||this,Q=R._cacheData,P=U.length,T,V;for(var S in U){T=U[S];V=T.id;if(Q[V]){j(T,Q[V]);delete Q[V]}}R.handle(U)},load:function(R){R=A(R);if(R.length){var P=this,Q=P.options;y({url:Q.url,cache:false,dataType:"json",data:{ids:R.join(",")},context:P,success:P._loadSuccess})}},handle:function(Q){var Z=this,T=Z.data,U=Z.dataHash,R={};Q=Q||[];var P=Q.length,X,V,Y;for(var S in Q){X=Q[S],id=X.id;if(id){if(!U[id]){U[id]={};T.push(U[id])}Y=O(U[id],X);if(Y){V=Y.presence||"update";R[V]=R[V]||[];j(U[id],Y);R[V].push(U[id])}}}for(var W in R){Z.trigger(W,[R[W]])}}});(function(){b("room",{urls:{join:"/webim/join.php",leave:"/webim/leave.php",member:"/webim/members.php"}},{_init:function(){var P=this;P.data=P.data||[];P.dataHash={}},get:function(P){return this.dataHash[P]},block:function(S){var P=this,R=P.dataHash[S];if(R&&!R.blocked){R.blocked=true;var Q=[];I(P.dataHash,function(U,T){if(T.blocked){Q.push(T.id)}});P.trigger("block",[S,Q])}},unblock:function(S){var P=this,R=P.dataHash[S];if(R&&R.blocked){R.blocked=false;var Q=[];I(P.dataHash,function(U,T){if(T.blocked){Q.push(T.id)}});P.trigger("unblock",[S,Q])}},handle:function(T){var Q=this,S=Q.data,R=Q.dataHash,P={};I(T,function(V,U){var W=U.id;if(W){U.members=U.members||[];U.count=U.count||0;U.all_count=U.all_count||0;if(!R[W]){R[W]=U;S.push(U)}else{j(R[W],U)}Q.trigger("join",[R[W]])}})},addMember:function(S,U){var Q=this;if(t(U)){I(U,function(X,W){Q.addMember(S,W)});return}var T=Q.dataHash[S];if(T){var P=T.members,V;for(var R=P.length;R--;R){if(P[R].id==U.id){V=P[R]}}if(!V){U.name=U.nick||U.name;P.push(U);T.members.length;Q.trigger("addMember",[S,U])}}},removeMember:function(S,R){var T=this.dataHash[S];if(T){var P=T.members,U;for(var Q=P.length;Q--;Q){if(P[Q].id==R){U=P[Q];P.splice(Q,1);T.count--}}U&&self.trigger("removeMember",[S,U])}},initMember:function(Q){var P=this.dataHash[Q];if(P&&!P.initMember){P.initMember=true;this.loadMember(Q)}},loadMember:function(R){var P=this,Q=P.options;y({cache:false,url:Q.urls.member,dataType:"json",data:{ticket:Q.ticket,id:R},success:function(S){I(S,function(U,T){P.addMember(U,T)})}})},join:function(S,Q){var P=this,R=P.options;y({cache:false,url:R.urls.join,dataType:"json",data:{ticket:R.ticket,id:S,nick:Q.name},success:function(T){P.initMember(S);P.handle([T])}})},leave:function(T,Q){var P=this,R=P.options,S=P.dataHash[T];if(S){S.initMember=false;y({cache:false,url:R.urls.leave,data:{ticket:R.ticket,id:T,nick:Q.name}});P.trigger("leave",[S])}},clear:function(){}})})();b("notification",{url:"webim/notifications"},{grep:function(P,Q){return P&&P.text},handle:function(Q){var P=this;Q=L(o(Q),P.grep);if(Q.length){P.trigger("data",[Q])}},load:function(){var P=this,Q=P.options;y({url:Q.url,cache:false,dataType:"json",context:P,success:P.handle})}});b("history",{urls:{load:"",clear:""}},{_init:function(){this.data=this.data||{}},get:function(P){return this.data[P]},handle:function(T){var Z=this,V=Z.data,Q={};T=o(T);var S=T.length,Y,R,W=Z.options.userInfo.id;if(!S){return}for(var U=0;U<S;U++){Y=T[U];R=Y.to==W?Y.from:Y.to;if(R){Q[R]=Q[R]||[];Q[R].push(Y)}}var P=[];for(var X in Q){var Y=Q[X];if(V[X]){V[X]=V[X].concat(Y);Z._triggerMsg(X,Y)}else{P.push(X)}}Z.load(P)},_triggerMsg:function(Q,P){this.trigger("data",[Q,P])},clear:function(T){T=A(T);var Q=this,P=T.length,R=Q.options,U;if(P){for(var S=0;S<P;S++){U=T[S];Q.data[U]=[];Q.trigger("clear",[U])}y({url:R.urls.clear,cache:false,dataType:"json",data:{ids:T.join(",")}})}},init:function(S){var Q=this.self||this,P;for(var R in S){P=S[R];Q.data[R]=P;Q._triggerMsg(R,P)}},load:function(S){S=A(S);if(S.length){var P=this,Q=P.options;for(var R=0;R<S.length;R++){P.data[S[R]]=[]}y({url:Q.urls.load,cache:false,dataType:"json",data:{ids:S.join(",")},context:P,success:P.init})}}})})(window,document);model("hotpost",{url:"webim/hotpost"},{grep:function(a,b){return a&&a.text},handle:function(b){var a=this;b=grep(makeArray(b),a.grep);if(b.length){a.trigger("data",[b])}},load:function(){var a=this,b=a.options;ajax({url:b.url,cache:false,dataType:"json",context:a,success:a.handle})}});